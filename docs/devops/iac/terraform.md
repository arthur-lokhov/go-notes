---
title: Terraform
description: Обзор Terraform, ведущего инструмента для управления инфраструктурой как кодом (IaC).
---

# Terraform: Управление инфраструктурой как кодом

!!! abstract "Тезис"
    **Terraform** — это инструмент для управления инфраструктурой как кодом (Infrastructure as Code, IaC) с открытым исходным кодом, созданный компанией **HashiCorp**. Он позволяет безопасно и эффективно создавать, изменять и версионировать инфраструктуру в любом облаке или дата-центре. Terraform использует декларативный язык конфигурации **HCL (HashiCorp Configuration Language)**.

---

## Ключевые возможности

-   **Декларативный подход**: Вы описываете желаемое состояние инфраструктуры, а Terraform сам определяет, как его достичь.
-   **План выполнения**: Перед применением изменений Terraform создает план, который показывает, какие ресурсы будут созданы, изменены или удалены. Это позволяет избежать неожиданных последствий.
-   **Граф ресурсов**: Terraform строит граф зависимостей между ресурсами, что позволяет эффективно и параллельно управлять инфраструктурой.
-   **Мульти-облачность**: Поддержка сотен провайдеров (AWS, Google Cloud, Azure, Kubernetes и др.) позволяет управлять всей инфраструктурой из одного места.
-   **Состояние (State)**: Terraform хранит состояние управляемой инфраструктуры в специальном файле (`terraform.tfstate`), что позволяет отслеживать изменения и зависимости.

---

## Жизненный цикл Terraform

Основной рабочий процесс в Terraform состоит из трех команд:

1.  **`terraform init`**: Инициализирует рабочую директорию, загружая необходимые плагины для провайдеров.
2.  **`terraform plan`**: Создает план выполнения. Terraform сравнивает желаемое состояние (в коде) с текущим состоянием (в `tfstate` и в реальности) и показывает, что нужно сделать.
3.  **`terraform apply`**: Применяет изменения, описанные в плане.

!!! example "Схема работы Terraform"
    ```plaintext
    +-------------------+   (1. init)   +-------------------+
    | Terraform Config  | -----------> | Terraform Core    | (Downloads plugins)
    | (*.tf files)      |             |                   |
    +-------------------+   (2. plan)   | +---------------+ |
                          -----------> | | Creates Plan  | |
    +-------------------+             | +---------------+ |
    |  Terraform State  | <---------> | | (Shows diff)  | |
    |  (.tfstate file)  |             | +---------------+ |
    +-------------------+   (3. apply)  |                   |
                          -----------> | (Executes plan)   |
                                      +--------+----------+
                                               |
                                               | (API Calls)
                                      +--------v----------+
                                      |   Cloud Provider  |
                                      | (AWS, GCP, Azure) |
                                      +-------------------+
    ```

---

## Пример конфигурации

!!! example "Пример `main.tf`"
    ```hcl
    terraform {
      required_providers {
        aws = {
          source  = "hashicorp/aws"
          version = "~> 4.0"
        }
      }
    }

    provider "aws" {
      region = "us-west-2"
    }

    resource "aws_instance" "app_server" {
      ami           = "ami-08d70e59c07c61a3a"
      instance_type = "t2.micro"

      tags = {
        Name = "ExampleAppServerInstance"
      }
    }
    ```

---

## Преимущества и недостатки

**Преимущества:**
-   **Стандарт де-факто для IaC**: Огромное сообщество и поддержка.
-   **Мульти-облачность**: Единый инструмент для управления всей инфраструктурой.
-   **Безопасность**: План выполнения позволяет избежать ошибок.
-   **Версионирование**: Инфраструктура как код хранится в Git, что позволяет отслеживать изменения.

**Недостатки:**
-   **Управление состоянием**: Файл состояния (`tfstate`) является критически важным и требует бережного обращения (часто используется удаленное хранилище, такое как S3, с блокировками).
-   **Язык HCL**: Хотя HCL прост, он не является языком программирования общего назначения, что может ограничивать в сложных сценариях.
