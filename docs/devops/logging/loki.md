---
title: Loki
description: Обзор Loki, системы сбора логов от Grafana Labs, вдохновленной Prometheus.
---

# Loki: Логи как метрики

!!! abstract "Тезис"
    **Loki** — это горизонтально масштабируемая, высокодоступная система сбора логов с мульти-тенантами, созданная **Grafana Labs**. Ее ключевая идея — не индексировать содержимое логов, а индексировать только метаданные (лейблы), как это делает Prometheus. Это делает Loki чрезвычайно эффективной по стоимости и простой в эксплуатации.

---

## Ключевые возможности

-   **Эффективность хранения**: Индексируются только лейблы, а не полный текст логов, что значительно снижает затраты на хранение.
-   **Интеграция с Grafana**: Идеально интегрируется с Grafana для визуализации логов и их корреляции с метриками из Prometheus.
-   **LogQL**: Язык запросов, вдохновленный PromQL, для фильтрации и анализа логов.
-   **Масштабируемость**: Горизонтально масштабируемая архитектура, подходящая для больших объемов данных.
-   **Простота**: Легко развертывать и обслуживать.

---

## Архитектура

Loki состоит из нескольких компонентов, которые могут работать как один бинарный файл или как отдельные микросервисы.

!!! example "Схема архитектуры Loki"
    ```plaintext
    +----------+     +-----------------+     +------------------+
    | Promtail | --> | Distributor     | --> | Ingester         |
    | (Agent)  |     +-----------------+     +------------------+
    +----------+           ^                       |
                           | (Queries)             | (Writes chunks)
    +----------+           |                       v
    | Grafana  | --------> | Querier         +------------------+
    +----------+           +-----------------+ |   Storage        |
                                             | (S3, GCS, etc.)  |
                                             +------------------+
    ```

-   **Promtail**: Агент, который собирает логи, прикрепляет к ним лейблы и отправляет в Loki.
-   **Distributor**: Принимает логи от Promtail и направляет их на правильный Ingester.
-   **Ingester**: Получает логи, сжимает их в "чанки" и сохраняет в долгосрочное хранилище.
-   **Querier**: Обрабатывает запросы LogQL, запрашивая данные у Ingester'ов и из хранилища.

---

## Пример запроса LogQL

!!! example "Запрос LogQL"
    ```logql
    # Найти все логи для приложения 'myapp' в неймспейсе 'prod',
    # которые содержат слово 'error' и имеют статус 500.
    {app="myapp", namespace="prod"} |= "error" | json | status_code == 500
    ```

---

## Преимущества и недостатки

**Преимущества:**
-   **Стоимость**: Очень дешево хранить и индексировать логи.
-   **Простота**: Легко начать работу, особенно если вы уже используете Prometheus и Grafana.
-   **Корреляция метрик и логов**: Легко переключаться между метриками в Prometheus и логами в Loki в интерфейсе Grafana.

**Недостатки:**
-   **Ограниченный поиск**: Так как полный текст не индексируется, запросы по содержимому могут быть медленными.
-   **Не для аналитики**: Loki не предназначен для сложной аналитики по логам, в отличие от Elasticsearch.
