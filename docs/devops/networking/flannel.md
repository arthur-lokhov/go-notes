---
title: Flannel
description: Обзор Flannel, простого и популярного CNI-плагина для Kubernetes.
---

# Flannel: Простая сеть для Kubernetes

!!! abstract "Тезис"
    **Flannel** — это простой и легкий в использовании CNI-плагин для Kubernetes, который решает основную задачу: обеспечение сетевой связности между подами в кластере. Он работает путем создания `overlay`-сети, которая охватывает все узлы кластера.

---

## Ключевые возможности

-   **Простота**: Очень легко устанавливать и настраивать.
-   **Надежность**: Проверенное и стабильное решение.
-   **Различные бэкенды**: Поддерживает несколько технологий для инкапсуляции трафика, самые популярные из которых — **VXLAN** и **host-gw**.

!!! warning "Отсутствие сетевых политик"
    Ключевым ограничением Flannel является то, что он **не поддерживает** `NetworkPolicy` Kubernetes. Если вам нужна изоляция трафика между подами, вам придется использовать другой CNI-плагин, например, Calico или Cilium.

---

## Архитектура

Flannel работает как демон (`flanneld`) на каждом узле кластера.

!!! example "Схема архитектуры Flannel (VXLAN backend)"
    ```plaintext
    +--------------------Node 1--------------------+
    | Pod A (10.0.1.2) -> [flannel.1] -> eth0 -> ... |
    +--------------------------------------------+
                               |
                               | (VXLAN-encapsulated packet)
                               v
    +--------------------Node 2--------------------+
    | ... -> eth0 -> [flannel.1] -> Pod B (10.0.2.2) |
    +--------------------------------------------+
    ```

1.  `flanneld` получает от API-сервера Kubernetes CIDR-блок (диапазон IP-адресов) для своего узла.
2.  Он создает `overlay`-сеть (например, с помощью VXLAN-устройства `flannel.1`).
3.  Когда под на одном узле отправляет трафик поду на другом узле, Flannel инкапсулирует пакет и отправляет его по сети хостов.
4.  На принимающем узле Flannel декапсулирует пакет и направляет его целевому поду.

---

## Бэкенды

-   **VXLAN**: Самый популярный и гибкий бэкенд. Инкапсулирует L2-трафик в UDP-пакеты. Работает практически в любой сетевой среде.
-   **host-gw**: Более производительный бэкенд, который не использует инкапсуляцию. Вместо этого он создает маршруты в таблице маршрутизации хоста. Требует, чтобы все узлы находились в одной L2-сети.

---

## Преимущества и недостатки

**Преимущества:**
-   **Простота**: Идеален для начинающих, тестовых окружений и простых кластеров.
-   **Стабильность**: Надежное и проверенное решение.

**Недостатки:**
-   **Отсутствие NetworkPolicy**: Самый большой недостаток.
-   **Производительность**: `overlay`-сети (особенно VXLAN) добавляют накладные расходы по сравнению с решениями без инкапсуляции (Calico, Cilium).

!!! success "Рекомендация"
    Используйте **Flannel**, если вам нужно быстро поднять кластер и не требуются сетевые политики. Для production-окружений, где важна безопасность и производительность, рассмотрите **Calico** или **Cilium**.
