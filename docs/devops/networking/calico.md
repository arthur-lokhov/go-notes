---
title: Calico
description: Обзор Calico, популярного CNI-плагина для Kubernetes, использующего BGP.
---

# Calico: Сеть и политики без оверлеев

!!! abstract "Тезис"
    **Calico** — это высокопроизводительный CNI-плагин с открытым исходным кодом, который обеспечивает сетевое взаимодействие и безопасность в Kubernetes. Его ключевая особенность — отказ от `overlay`-сетей в пользу чистой L3-маршрутизации с использованием протокола **BGP (Border Gateway Protocol)**.

---

## Ключевые возможности

-   **Высокая производительность**: Отсутствие инкапсуляции (как в VXLAN) означает, что пакеты передаются с минимальными накладными расходами, почти как на "голом железе".
-   **Масштабируемость**: Проверен в очень крупных кластерах (тысячи узлов).
-   **Сетевые политики**: Calico был одним из первых CNI, предложивших мощную реализацию `NetworkPolicy`.
-   **Гибкость развертывания**: Может работать как с BGP, так и в `overlay`-режиме (VXLAN или IPIP), если сетевая инфраструктура не поддерживает BGP.
-   **Интеграция с не-Kubernetes окружениями**: Может использоваться для защиты и связи bare-metal серверов и виртуальных машин.

---

## Архитектура

!!! example "Схема архитектуры Calico"
    ```plaintext
    +--------------------Node 1--------------------+
    | +------------------+   +------------------+ |
    | |      Pod A       |   |      Pod B       | |
    | | (10.0.1.2/32)    |   | (10.0.1.3/32)    | |
    | +--------+---------+   +--------+---------+ |
    |          |                      |
    | +--------v----------------------v---------+ |
    | |           Linux Kernel Routing         | |
    | | (Routes for Pods injected by Felix)    | |
    | +----------------------------------------+ |
    | |              Calico Agent              | |
    | | (Felix + BIRD/confd)                   | |
    | +----------------------------------------+ |
    +--------------------------------------------+
    ```

-   **Felix**: Агент Calico, который работает на каждом узле. Он программирует маршруты в ядре Linux и правила ACL (Access Control Lists) для реализации сетевых политик.
-   **BIRD/confd**: BGP-клиент, который обменивается маршрутной информацией с другими узлами кластера. Каждый узел анонсирует IP-адреса подов, которые на нем запущены.
-   **etcd**: Используется как хранилище для конфигурации и состояния Calico (политик, IP-адресов и т.д.).

---

## Сетевые политики

Calico полностью поддерживает стандартные `NetworkPolicy` Kubernetes. Он также предоставляет свой собственный CRD `GlobalNetworkPolicy`, который позволяет определять политики, действующие в масштабах всего кластера.

!!! example "Пример NetworkPolicy"
    ```yaml
    apiVersion: networking.k8s.io/v1
    kind: NetworkPolicy
    metadata:
      name: default-deny-ingress
    spec:
      podSelector: {}
      policyTypes:
      - Ingress
    ```
    Эта политика блокирует весь входящий трафик для всех подов в данном неймспейсе, что является хорошей отправной точкой для модели "zero-trust".

---

## Преимущества и недостатки

**Преимущества:**
-   **Производительность**: Отсутствие оверлеев обеспечивает минимальные задержки.
-   **Масштабируемость**: Проверенная архитектура для больших кластеров.
-   **Простота отладки**: Трафик можно анализировать стандартными сетевыми утилитами (`tcpdump`, `traceroute`), так как нет инкапсуляции.

**Недостатки:**
-   **Требования к сети**: Для работы в BGP-режиме может потребоваться настройка сетевого оборудования (если оно не поддерживает BGP "из коробки").
-   **Меньше "магии"**: По сравнению с Cilium, предоставляет меньше встроенных средств для L7-наблюдаемости.
