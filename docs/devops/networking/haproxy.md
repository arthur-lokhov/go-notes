---
title: HAProxy
description: Обзор HAProxy, одного из самых быстрых и надежных балансировщиков нагрузки.
---

# HAProxy: Высокопроизводительная балансировка нагрузки

!!! abstract "Тезис"
    **HAProxy (High Availability Proxy)** — это бесплатный, чрезвычайно быстрый и надежный балансировщик нагрузки и прокси-сервер с открытым исходным кодом для TCP и HTTP-приложений. Он известен своей высочайшей производительностью, низким потреблением ресурсов и стабильностью, что делает его стандартом де-факто для высоконагруженных систем.

---

## Ключевые возможности

-   **Производительность**: Один из самых быстрых балансировщиков в мире. Его событийно-ориентированная, однопроцессная модель позволяет обрабатывать огромный трафик с минимальными задержками.
-   **Надежность**: Проверен десятилетиями в самых требовательных окружениях.
-   **Балансировка L4 и L7**: Может работать как на транспортном уровне (TCP), так и на уровне приложений (HTTP).
-   **Расширенные проверки состояния (Health Checks)**: Гибкие и настраиваемые проверки для точного определения работоспособности бэкендов.
-   **SSL/TLS Termination**: Эффективная обработка TLS-трафика.
-   **Гибкая конфигурация**: Мощный конфигурационный файл, позволяющий реализовывать сложные сценарии маршрутизации.

---

## Архитектура

HAProxy использует однопоточную, событийно-ориентированную модель, которая позволяет избежать дорогостоящего переключения контекста, характерного для многопоточных архитектур.

!!! example "Схема работы HAProxy"
    ```plaintext
    +----------+      +------------------------------------+
    |  Client  |----->|              HAProxy               |
    +----------+      | +-----------+      +-------------+ |
                      | | Frontend  |----->|   Backend   | |
                      | | (e.g. :443)|      | (pool of    | |
                      | +-----------+      |  servers)   | |
                      |                    +--+----------+ |
                      +-----------------------|------------+
                                              |
                               +--------------+--------------+
                               |              |              |
                         +-----v----+   +-----v----+   +-----v----+
                         | Server 1 |   | Server 2 |   | Server 3 |
                         +----------+   +----------+   +----------+
    ```

-   **Frontend**: Определяет, как HAProxy принимает входящий трафик (IP-адреса, порты).
-   **Backend**: Определяет пул серверов, между которыми будет распределяться трафик.
-   **ACL (Access Control Lists)**: Позволяют создавать гибкие правила для маршрутизации трафика на основе различных атрибутов запроса.

---

## Пример конфигурации

!!! example "Пример `haproxy.cfg`"
    ```hcl
    frontend http_front
       bind *:80
       default_backend http_back

    backend http_back
       balance roundrobin
       server s1 backend1.example.com:80 check
       server s2 backend2.example.com:80 check
    ```
    Эта простая конфигурация принимает трафик на порту 80 и распределяет его по двум бэкенд-серверам, используя алгоритм `roundrobin` и проверяя их доступность.

---

## HAProxy vs Nginx

-   **HAProxy** исторически был сфокусирован исключительно на балансировке нагрузки и проксировании, и в этой задаче он часто показывает лучшую производительность и имеет более продвинутые функции (например, более гибкие health checks).
-   **Nginx** — это в первую очередь веб-сервер, который также отлично выполняет функции reverse proxy и балансировщика. Он более универсален (например, лучше работает со статическим контентом).

!!! success "Рекомендация"
    -   Используйте **HAProxy**, когда вам нужна максимальная производительность и надежность именно в задачах балансировки TCP/HTTP трафика.
    -   Используйте **Nginx**, если вам нужен универсальный инструмент, сочетающий в себе веб-сервер и reverse proxy.

    В современных системах выбор между ними часто зависит от экспертизы команды и специфических требований проекта.
