---
title: auditd ‚Äî –°–∏—Å—Ç–µ–º–∞ –∞—É–¥–∏—Ç–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
---

# üßæ auditd: –°–∏—Å—Ç–µ–º–∞ –∞—É–¥–∏—Ç–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

**auditd** ‚Äî —ç—Ç–æ userspace-–∫–æ–º–ø–æ–Ω–µ–Ω—Ç –ø–æ–¥—Å–∏—Å—Ç–µ–º—ã –∞—É–¥–∏—Ç–∞ —è–¥—Ä–∞ Linux. –ï–≥–æ –∑–∞–¥–∞—á–∞ ‚Äî —Å–æ–±–∏—Ä–∞—Ç—å –∏ –∑–∞–ø–∏—Å—ã–≤–∞—Ç—å –Ω–∞ –¥–∏—Å–∫ –¥–µ—Ç–∞–ª—å–Ω—ã–µ –ª–æ–≥–∏ –æ–±–æ –≤—Å–µ—Ö —Å–æ–±—ã—Ç–∏—è—Ö, —Å–≤—è–∑–∞–Ω–Ω—ã—Ö —Å –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å—é. `auditd` –º–æ–∂–µ—Ç –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏ –≤—Å—ë: –æ—Ç —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –≤—ã–∑–æ–≤–æ–≤ –∏ –¥–æ—Å—Ç—É–ø–∞ –∫ —Ñ–∞–π–ª–∞–º –¥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∫–æ–º–∞–Ω–¥ –∏ —Å–µ—Ç–µ–≤—ã—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π. –≠—Ç–æ –Ω–µ–∑–∞–º–µ–Ω–∏–º—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∞–º (compliance), —Ä–∞—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è –∏–Ω—Ü–∏–¥–µ–Ω—Ç–æ–≤ –∏ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è –≤—Ç–æ—Ä–∂–µ–Ω–∏–π.

## üéØ –¶–µ–ª—å —Ä–∞–∑–¥–µ–ª–∞

- –ü–æ–Ω—è—Ç—å –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É —Å–∏—Å—Ç–µ–º—ã –∞—É–¥–∏—Ç–∞ (`kauditd` + `auditd`).
- –ù–∞—É—á–∏—Ç—å—Å—è –ø–∏—Å–∞—Ç—å –ø—Ä–∞–≤–∏–ª–∞ –∞—É–¥–∏—Ç–∞ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –¥–æ—Å—Ç—É–ø–∞ –∫ —Ñ–∞–π–ª–∞–º –∏ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –≤—ã–∑–æ–≤–æ–≤.
- –û—Å–≤–æ–∏—Ç—å —É—Ç–∏–ª–∏—Ç—ã `ausearch` –∏ `aureport` –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –ª–æ–≥–æ–≤.
- –ü–æ–Ω—è—Ç—å, –∫–∞–∫ `auditd` –∏–Ω—Ç–µ–≥—Ä–∏—Ä—É–µ—Ç—Å—è —Å `SELinux` –∏ `AppArmor`.

---

## üèõÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

–°–∏—Å—Ç–µ–º–∞ –∞—É–¥–∏—Ç–∞ —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ –¥–≤—É—Ö —á–∞—Å—Ç–µ–π:

1.  **`kauditd` (–≤ —è–¥—Ä–µ):** –≠—Ç–∞ —á–∞—Å—Ç—å —è–¥—Ä–∞ –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç —Å–∏—Å—Ç–µ–º–Ω—ã–µ –≤—ã–∑–æ–≤—ã, —Å—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç –∏—Ö —Å –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–º–∏ –ø—Ä–∞–≤–∏–ª–∞–º–∏ –∏, –µ—Å–ª–∏ –Ω–∞—Ö–æ–¥–∏—Ç —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ, —Å–æ–∑–¥–∞—ë—Ç —Å–æ–±—ã—Ç–∏–µ –∞—É–¥–∏—Ç–∞.
2.  **`auditd` (–≤ userspace):** –î–µ–º–æ–Ω, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–ª—É—á–∞–µ—Ç —Å–æ–±—ã—Ç–∏—è –æ—Ç —è–¥—Ä–∞ –∏ –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç –∏—Ö –≤ –ª–æ–≥-—Ñ–∞–π–ª (–æ–±—ã—á–Ω–æ `/var/log/audit/audit.log`).

–ü—Ä–∞–≤–∏–ª–∞ –¥–ª—è —è–¥—Ä–∞ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –∏–∑ —Ñ–∞–π–ª–æ–≤ –≤ –∫–∞—Ç–∞–ª–æ–≥–µ `/etc/audit/rules.d/`. `auditd` –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –æ–±—ä–µ–¥–∏–Ω—è–µ—Ç –≤—Å–µ `.rules` —Ñ–∞–π–ª—ã –≤ –æ–¥–∏–Ω –∏ –∑–∞–≥—Ä—É–∂–∞–µ—Ç –∏—Ö –≤ —è–¥—Ä–æ.

--- 

## üìú –ü—Ä–∞–≤–∏–ª–∞ –∞—É–¥–∏—Ç–∞

–ü—Ä–∞–≤–∏–ª–∞ ‚Äî —ç—Ç–æ —Å–µ—Ä–¥—Ü–µ —Å–∏—Å—Ç–µ–º—ã. –û–Ω–∏ –æ–ø—Ä–µ–¥–µ–ª—è—é—Ç, **—á—Ç–æ –∏–º–µ–Ω–Ω–æ** –Ω—É–∂–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å. –°—É—â–µ—Å—Ç–≤—É–µ—Ç —Ç—Ä–∏ –æ—Å–Ω–æ–≤–Ω—ã—Ö —Ç–∏–ø–∞ –ø—Ä–∞–≤–∏–ª.

### 1. –ö–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞ (Control Rules)

–≠—Ç–∏ –ø—Ä–∞–≤–∏–ª–∞ —É–ø—Ä–∞–≤–ª—è—é—Ç –ø–æ–≤–µ–¥–µ–Ω–∏–µ–º —Å–∞–º–æ–π —Å–∏—Å—Ç–µ–º—ã –∞—É–¥–∏—Ç–∞.

- `-b <size>`: –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ä–∞–∑–º–µ—Ä –±—É—Ñ–µ—Ä–∞ –≤ —è–¥—Ä–µ.
- `-f <rate>`: –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ª–∏–º–∏—Ç –Ω–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–æ–±—â–µ–Ω–∏–π –≤ —Å–µ–∫—É–Ω–¥—É.
- `-e [0|1|2]`: –í–∫–ª—é—á–∏—Ç—å/–≤—ã–∫–ª—é—á–∏—Ç—å –∞—É–¥–∏—Ç. `1` ‚Äî –≤–∫–ª—é—á–∏—Ç—å, `2` ‚Äî –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å —Å–∏—Å—Ç–µ–º—É, –µ—Å–ª–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ (immutable mode).

**–ü—Ä–∏–º–µ—Ä:**
`# –£–¥–∞–ª–∏—Ç—å –≤—Å–µ –ø—Ä–µ–¥—ã–¥—É—â–∏–µ –ø—Ä–∞–≤–∏–ª–∞
-D

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –±—É—Ñ–µ—Ä –≤ 8192 KB
-b 8192

# –°–¥–µ–ª–∞—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –Ω–µ–∏–∑–º–µ–Ω—è–µ–º–æ–π –¥–æ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏
-e 2`

### 2. –ü—Ä–∞–≤–∏–ª–∞ –¥–ª—è —Ñ–∞–π–ª–æ–≤ (File System Watches)

–≠—Ç–æ —Å–∞–º—ã–π –ø—Ä–æ—Å—Ç–æ–π –∏ —á–∞—Å—Ç—ã–π —Ç–∏–ø –ø—Ä–∞–≤–∏–ª. –û–Ω–∏ –æ—Ç—Å–ª–µ–∂–∏–≤–∞—é—Ç –¥–æ—Å—Ç—É–ø –∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º —Ñ–∞–π–ª–∞–º –∏–ª–∏ –∫–∞—Ç–∞–ª–æ–≥–∞–º.

–°–∏–Ω—Ç–∞–∫—Å–∏—Å: `-w /path/to/file -p rwax -k key_name`

- **`-w /path/to/file`**: –ü—É—Ç—å –∫ —Ñ–∞–π–ª—É –∏–ª–∏ –∫–∞—Ç–∞–ª–æ–≥—É.
- **`-p rwax`**: –ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞, –∫–æ—Ç–æ—Ä—ã–µ –Ω—É–∂–Ω–æ –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å (`r` - read, `w` - write, `x` - execute, `a` - attribute change).
- **`-k key_name`**: –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∫–ª—é—á (—Å—Ç—Ä–æ–∫–∞) –¥–ª—è —ç—Ç–æ–≥–æ –ø—Ä–∞–≤–∏–ª–∞, —á—Ç–æ–±—ã –ø–æ—Ç–æ–º –±—ã–ª–æ –ª–µ–≥–∫–æ –∏—Å–∫–∞—Ç—å —Å–æ–±—ã—Ç–∏—è –ø–æ –Ω–µ–º—É.

**–ü—Ä–∏–º–µ—Ä (`/etc/audit/rules.d/my-watches.rules`):**
```
# –û—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –ª—é–±—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ —Ñ–∞–π–ª–∞—Ö, —Å–≤—è–∑–∞–Ω–Ω—ã—Ö —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
-w /etc/passwd -p wa -k user_changes
-w /etc/shadow -p wa -k user_changes
-w /etc/group -p wa -k user_changes

# –û—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å —á—Ç–µ–Ω–∏–µ —Å–µ–∫—Ä–µ—Ç–Ω–æ–≥–æ –∫–ª—é—á–∞
-w /etc/ssl/private/my.key -p r -k secret_key_access
```

### 3. –ü—Ä–∞–≤–∏–ª–∞ –¥–ª—è —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –≤—ã–∑–æ–≤–æ–≤ (Syscall Rules)

–≠—Ç–æ —Å–∞–º—ã–π –º–æ—â–Ω—ã–π —Ç–∏–ø –ø—Ä–∞–≤–∏–ª. –û–Ω–∏ –ø–æ–∑–≤–æ–ª—è—é—Ç –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –≤—ã–∑–æ–≤ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –≤—ã–∑–æ–≤–æ–≤ —Å –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏.

–°–∏–Ω—Ç–∞–∫—Å–∏—Å: `-a action,list -S syscall_name -F field=value -k key_name`

- **`-a action,list`**: `action` (`always` –∏–ª–∏ `never`) –∏ `list` (`task`, `exit`, `user`, `exclude`). –ß–∞—â–µ –≤—Å–µ–≥–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `always,exit` ‚Äî –≤—Å–µ–≥–¥–∞ —Å–æ–∑–¥–∞–≤–∞—Ç—å —Å–æ–±—ã—Ç–∏–µ –Ω–∞ –≤—ã—Ö–æ–¥–µ –∏–∑ —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ –≤—ã–∑–æ–≤–∞.
- **`-S syscall_name`**: –ò–º—è —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ –≤—ã–∑–æ–≤–∞ (`openat`, `execve`, `connect`).
- **`-F field=value`**: –§–∏–ª—å—Ç—Ä –ø–æ –ø–æ–ª—è–º (–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞, UID, GID –∏ —Ç.–¥.).

**–ü—Ä–∏–º–µ—Ä:**
```
# –û—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∫–æ–º–∞–Ω–¥—ã chmod –≤—Å–µ–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
-a always,exit -F arch=b64 -S chmod -F auid>=1000 -F auid!=4294967295 -k chmod_usage

# –û—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –Ω–µ—É–¥–∞—á–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏ –æ—Ç–∫—Ä—ã—Ç—å —Ñ–∞–π–ª
-a always,exit -F arch=b64 -S openat -F exit=-EPERM -k failed_open
-a always,exit -F arch=b64 -S openat -F exit=-EACCES -k failed_open
```

--- 

## üõ†Ô∏è –ê–Ω–∞–ª–∏–∑ –ª–æ–≥–æ–≤

–õ–æ–≥–∏ `auditd` –æ—á–µ–Ω—å –ø–æ–¥—Ä–æ–±–Ω—ã, –Ω–æ —á–∏—Ç–∞—Ç—å –∏—Ö –Ω–∞–ø—Ä—è–º—É—é —Å–ª–æ–∂–Ω–æ. –î–ª—è –∞–Ω–∞–ª–∏–∑–∞ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —É—Ç–∏–ª–∏—Ç—ã.

### `ausearch`: –ü–æ–∏—Å–∫ —Å–æ–±—ã—Ç–∏–π

`ausearch` –ø–æ–∑–≤–æ–ª—è–µ—Ç –∏—Å–∫–∞—Ç—å —Å–æ–±—ã—Ç–∏—è –≤ `audit.log` –ø–æ —Ä–∞–∑–ª–∏—á–Ω—ã–º –∫—Ä–∏—Ç–µ—Ä–∏—è–º.

```bash
# –ù–∞–π—Ç–∏ –≤—Å–µ —Å–æ–±—ã—Ç–∏—è, —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å –∫–ª—é—á–æ–º 'user_changes'
ausearch -k user_changes

# –ù–∞–π—Ç–∏ –≤—Å–µ —Å–æ–±—ã—Ç–∏—è, —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å —Å–∏—Å—Ç–µ–º–Ω—ã–º –≤—ã–∑–æ–≤–æ–º 'chmod'
ausearch -sc chmod

# –ù–∞–π—Ç–∏ –≤—Å–µ —Å–æ–±—ã—Ç–∏—è –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å UID 1000 –∑–∞ —Å–µ–≥–æ–¥–Ω—è
ausearch -ua 1000 --start today

# –ü–æ–∫–∞–∑–∞—Ç—å —Å–æ–±—ã—Ç–∏—è –≤ "–∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–º" –≤–∏–¥–µ (–∏–º–µ–Ω–∞ –≤–º–µ—Å—Ç–æ —á–∏—Å–µ–ª)
ausearch -k user_changes -i
```

### `aureport`: –°–æ–∑–¥–∞–Ω–∏–µ –æ—Ç—á—ë—Ç–æ–≤

`aureport` –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –ª–æ–≥–∏ –∏ —Å–æ–∑–¥–∞—ë—Ç —Å–≤–æ–¥–Ω—ã–µ –æ—Ç—á—ë—Ç—ã.

```bash
# –û—Ç—á—ë—Ç –ø–æ –∫–ª—é—á–∞–º
aureport -k

# –û—Ç—á—ë—Ç –ø–æ —Å–æ–±—ã—Ç–∏—è–º –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
aureport -au

# –°–≤–æ–¥–Ω—ã–π –æ—Ç—á—ë—Ç –ø–æ –≤—Å–µ–º —Å–æ–±—ã—Ç–∏—è–º –∑–∞ –¥–µ–Ω—å
aureport --summary --start today
```

--- 

## üîó –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å SELinux/AppArmor

`auditd` —è–≤–ª—è–µ—Ç—Å—è –Ω–µ–æ—Ç—ä–µ–º–ª–µ–º–æ–π —á–∞—Å—Ç—å—é —Å–∏—Å—Ç–µ–º –º–∞–Ω–¥–∞—Ç–Ω–æ–≥–æ –∫–æ–Ω—Ç—Ä–æ–ª—è –¥–æ—Å—Ç—É–ø–∞.

- **SELinux:** –í—Å–µ —Å–æ–±—ã—Ç–∏—è `AVC (Access Vector Cache)` (–∑–∞–ø—Ä–µ—Ç—ã –¥–æ—Å—Ç—É–ø–∞) –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –ª–æ–≥–∏—Ä—É—é—Ç—Å—è —á–µ—Ä–µ–∑ `auditd`. –ö–æ–º–∞–Ω–¥–∞ `ausearch -m avc` –ø–æ–∫–∞–∂–µ—Ç –≤—Å–µ –æ—Ç–∫–∞–∑—ã SELinux.
- **AppArmor:** –ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ, –≤—Å–µ –∑–∞–ø—Ä–µ—Ç—ã AppArmor –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –≤ `audit.log` –∏ –º–æ–≥—É—Ç –±—ã—Ç—å –Ω–∞–π–¥–µ–Ω—ã —Å –ø–æ–º–æ—â—å—é `ausearch -m apparmor`.

–≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ —Å–æ–±–∏—Ä–∞—Ç—å –≤—Å–µ —Å–æ–±—ã—Ç–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏, –∫–∞–∫ –æ—Ç `auditd`, —Ç–∞–∫ –∏ –æ—Ç MAC-—Å–∏—Å—Ç–µ–º, –¥–ª—è –ø–æ—Å–ª–µ–¥—É—é—â–µ–≥–æ –∞–Ω–∞–ª–∏–∑–∞.
