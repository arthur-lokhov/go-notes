---
title: eBPF
---

# üß† eBPF: –ü—Ä–æ–≥—Ä–∞–º–º–∏—Ä—É–µ–º–æ–µ —è–¥—Ä–æ

!!! info "–ß—Ç–æ —Ç–∞–∫–æ–µ `eBPF`"

    **eBPF (extended Berkeley Packet Filter)** ‚Äî —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—è, –ø–æ–∑–≤–æ–ª—è—é—â–∞—è –∑–∞–ø—É—Å–∫–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã –≤ —è–¥—Ä–µ Linux –±–µ–∑ –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏–∏ –µ–≥–æ –∏—Å—Ö–æ–¥–Ω–æ–≥–æ –∫–æ–¥–∞.

    –≠—Ç–æ —Ä–µ–≤–æ–ª—é—Ü–∏–æ–Ω–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è —Å–µ—Ç–µ–π, –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏, –æ—Å–æ–±–µ–Ω–Ω–æ –≤ –æ–±–ª–∞—á–Ω—ã—Ö –∏ Kubernetes-—Å—Ä–µ–¥–∞—Ö.

---

## üîÑ –ñ–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª eBPF

!!! info "–≠—Ç–∞–ø—ã –∂–∏–∑–Ω–µ–Ω–Ω–æ–≥–æ —Ü–∏–∫–ª–∞ eBPF"

    –ñ–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª **eBPF** –º–æ–∂–Ω–æ –ø–æ–¥–µ–ª–∏—Ç—å –Ω–∞ —Ç—Ä–∏ —ç—Ç–∞–ø–∞:

    1. –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞.
    2. –í—ã–≥—Ä—É–∑–∫–∞ –≤ —è–¥—Ä–æ.
    3. –ò—Å–ø–æ–ª–Ω–µ–Ω–∏–µ –≤ —è–¥—Ä–µ.

1. **–†–∞–∑—Ä–∞–±–æ—Ç–∫–∞**

    - –ü–∏—à–µ—Ç—Å—è –Ω–∞ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–º –ø–æ–¥–º–Ω–æ–∂–µ—Å—Ç–≤–µ C –∏–ª–∏ —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö DSL (`bpftrace`).
    - –ö–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç—Å—è –≤ eBPF-–±–∞–π—Ç–∫–æ–¥ —á–µ—Ä–µ–∑ LLVM/Clang.

2. **–í—ã–≥—Ä—É–∑–∫–∞ –≤ —è–¥—Ä–æ**

    - –ü–µ—Ä–µ–¥–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ syscall `bpf()`.
    - –ü—Ä–æ—Ö–æ–¥–∏—Ç –º–Ω–æ–≥–æ—Å—Ç—É–ø–µ–Ω—á–∞—Ç—É—é –ø—Ä–æ–≤–µ—Ä–∫—É Verifier'–æ–º.

3. **–ò—Å–ø–æ–ª–Ω–µ–Ω–∏–µ –≤ —è–¥—Ä–µ**

    - JIT-–∫–æ–º–ø–∏–ª—è—Ü–∏—è –≤ –Ω–∞—Ç–∏–≤–Ω—ã–π –º–∞—à–∏–Ω–Ω—ã–π –∫–æ–¥.
    - –ü—Ä–∏–≤—è–∑–∫–∞ –∫ –≤—ã–±—Ä–∞–Ω–Ω—ã–º —Ç–æ—á–∫–∞–º –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è.
    - –ê–∫—Ç–∏–≤–∞—Ü–∏—è –ø–æ —Ç—Ä–∏–≥–≥–µ—Ä–Ω—ã–º —Å–æ–±—ã—Ç–∏—è–º.

!!! note "–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ"

    –ù–∞—á–∏–Ω–∞—è —Å Linux 5.3 –¥–æ–ø—É—Å–∫–∞—é—Ç—Å—è —Ü–∏–∫–ª—ã, –Ω–æ —Å –∂–µ—Å—Ç–∫–∏–º–∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è–º–∏:

    1. –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Å–ª–æ–∂–Ω–æ—Å—Ç—å (–¥–æ 1 –º–ª–Ω –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π).
    2. –ì–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ.
    3. –ü—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ.

!!! danger "–ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–æ –æ–ø–∞—Å–Ω–æ–µ –º–µ—Å—Ç–æ"

    Verifier –≤—ã–ø–æ–ª–Ω—è–µ—Ç —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑, –∫–æ—Ç–æ—Ä—ã–π –º–æ–∂–µ—Ç:

    - –õ–æ–∂–Ω–æ –æ—Ç–≤–µ—Ä–≥–∞—Ç—å –≤–∞–ª–∏–¥–Ω—ã–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã,
    - –ü—Ä–æ–ø—É—Å–∫–∞—Ç—å –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ edge-—Å–ª—É—á–∞–∏.

    –í—Å–µ–≥–¥–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ –ø—Ä–æ–≤–µ—Ä–∫—É:

    ```bash
    bpftool prog show
    dmesg | grep -i bpf
    journalctl -k --grep=bpf
    ```

---

## üîß –¢–æ—á–∫–∏ –∫—Ä–µ–ø–ª–µ–Ω–∏—è

| –¢–∏–ø –∫—Ä–µ–ø–ª–µ–Ω–∏—è                       | –û–ø–∏—Å–∞–Ω–∏–µ                                                | –ü—Ä–∏–º–µ—Ä –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è                                      |
| ----------------------------------- | ------------------------------------------------------- | ------------------------------------------------------ |
| **XDP**                             | –í—ã–∑–æ–≤ –≤ —Å–µ—Ç–µ–≤–æ–º –¥—Ä–∞–π–≤–µ—Ä–µ –¥–æ —Å–µ—Ç–µ–≤–æ–≥–æ —Å—Ç–µ–∫–∞              | DDoS-–∑–∞—â–∏—Ç–∞, –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞ –Ω–∞–≥—Ä—É–∑–∫–∏                     |
| **tc**                              | –í—ã–∑–æ–≤ –≤ —Å–µ—Ç–µ–≤–æ–º —Å—Ç–µ–∫–µ (ingress/egress)                  | –§–∞–µ—Ä–≤–æ–ª, QoS, —Å—á—ë—Ç—á–∏–∫–∏ –ø–∞–∫–µ—Ç–æ–≤                         |
| **kprobe/kretprobe**                | –í—ã–∑–æ–≤ –Ω–∞ –≤—Ö–æ–¥–µ/–≤—ã—Ö–æ–¥–µ –∏–∑ —Ñ—É–Ω–∫—Ü–∏–∏ —è–¥—Ä–∞                   | –¢—Ä–µ–π—Å–∏–Ω–≥ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –≤—ã–∑–æ–≤–æ–≤, –æ—Ç–ª–∞–¥–∫–∞ —è–¥—Ä–∞               |
| **tracepoint**                      | –°—Ç–∞–±–∏–ª—å–Ω—ã–µ —Ç–æ—á–∫–∏ –≤–Ω—É—Ç—Ä–∏ —è–¥—Ä–∞                            | –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã, —Å–æ–±—ã—Ç–∏–π —è–¥—Ä–∞              |
| **uprobes**                         | –ö—Ä–µ–ø–ª–µ–Ω–∏–µ –∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–º –±–∏–Ω–∞—Ä—è–º                    | –¢—Ä–µ–π—Å–∏–Ω–≥ —Å—Ç–æ—Ä–æ–Ω–Ω–∏—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π, –ø—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏–µ          |
| **cgroup hooks**                    | –í—ã–∑–æ–≤ –ø—Ä–∏ —Å–æ–±—ã—Ç–∏—è—Ö –≤–Ω—É—Ç—Ä–∏ cgroup                        | –°–µ—Ç–µ–≤–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞—Ö, –∏–∑–æ–ª—è—Ü–∏—è             |
| **LSM hooks**                       | –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ –≤ —è–¥—Ä–æ —Ç–æ—á–∫–∏ –¥–ª—è eBPF –Ω–∞ —É—Ä–æ–≤–Ω–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ | –ö–æ–Ω—Ç—Ä–æ–ª—å –¥–æ—Å—Ç—É–ø–∞ –∫ —Ñ–∞–π–ª–∞–º –∏ —Å–∏—Å—Ç–µ–º–Ω—ã–º –≤—ã–∑–æ–≤–∞–º          |
| **perf events**                     | –¢–æ—á–∫–∞ –≤—Ö–æ–∂–¥–µ–Ω–∏—è —á–µ—Ä–µ–∑ perf-–∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—É               | –°–±–æ—Ä –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏, –∞–Ω–∞–ª–∏–∑ –∑–∞–¥–µ—Ä–∂–µ–∫               |
| **socket filter (SO\_ATTACH\_BPF)** | –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–∞–∫–µ—Ç–æ–≤ –Ω–∞ —É—Ä–æ–≤–Ω–µ —Å–æ–∫–µ—Ç–æ–≤                    | –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Ç—Ä–∞—Ñ–∏–∫–∞, —Å–±–æ—Ä —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ —Å–µ—Ç–µ–≤—ã—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π |
| **fentry/fexit**                    | –í—Ö–æ–¥ –∏ –≤—ã—Ö–æ–¥ –∏–∑ —Ñ—É–Ω–∫—Ü–∏–π —è–¥—Ä–∞                            | –ü—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏–µ, —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∞ –≤—ã–∑–æ–≤–æ–≤ —Ñ—É–Ω–∫—Ü–∏–π            |

!!! success "–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è"

    –î–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `tracepoints` –≤–º–µ—Å—Ç–æ `kprobes`: –æ–Ω–∏ —Å—Ç–∞–±–∏–ª—å–Ω—ã –º–µ–∂–¥—É –≤–µ—Ä—Å–∏—è–º–∏ —è–¥—Ä–∞.

---

## üöÄ –û–±–ª–∞—Å—Ç–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è

1. **–°–µ—Ç–∏ (Cilium, XDP)**

    **Cilium**: –ó–∞–º–µ–Ω–∞ `kube-proxy` —á–µ—Ä–µ–∑ eBPF (–º–µ–Ω—å—à–µ latency, –Ω–µ—Ç iptables).
    
    **XDP**: –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–∞–∫–µ—Ç–æ–≤ –Ω–∞ —Å–∫–æ—Ä–æ—Å—Ç–∏ 100+ Gbps (Cloudflare, Facebook).

    !!! example "–û—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ –ø–∞–∫–µ—Ç–æ–≤ —Å IP 1.2.3.4 –Ω–∞ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ eth0"

        ```bash
        bpftool net attach xdp id <PROG_ID> dev eth0
        ```

2. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ (Falco, bpftrace)**

    **bpftrace**: –¢—Ä–µ–π—Å–∏–Ω–≥ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –≤—ã–∑–æ–≤–æ–≤ –±–µ–∑ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏.

    !!! example "–°–∏—Å—Ç–µ–º–Ω—ã–π –≤—ã–∑–æ–≤ —á–µ—Ä–µ–∑ `bpftrace`"

        ```bash
        bpftrace -e 'tracepoint:syscalls:sys_enter_execve { printf("%s -> %s\n", comm, str(args->filename)); }'
        ```

    **BCC**: –ù–∞–±–æ—Ä –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –¥–ª—è **eBPF**.
    –ù–∞–ø—Ä–∏–º–µ—Ä: `opensnoop`, `tcptop`.

    !!! tip "–°–æ–≤–µ—Ç"

        –î–ª—è –∞–Ω–∞–ª–∏–∑–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `perf_event` + **eBPF**.

        ```bash
        bpftool prog profile id <PROG_ID>
        ```

3. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å (LSM, seccomp)**

    **Falco**: –î–µ—Ç–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∞–Ω–æ–º–∞–ª–∏–π —á–µ—Ä–µ–∑ **eBPF**.

    **LSM hooks**: –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∑–∞–ø–∏—Å—å –≤ `/etc/shadow`).

    !!! warning "–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ"

        **eBPF**-–ø—Ä–æ–≥—Ä–∞–º–º—ã —Å `BPF_PROG_TYPE_LSM` —Ç—Ä–µ–±—É—é—Ç —è–¥—Ä–∞ **5.7+** –∏ –≤–∫–ª—é—á—ë–Ω–Ω–æ–≥–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ `CONFIG_BPF_LSM`.

---

## üõ†Ô∏è –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã

### `bpftool`

!!! info "–û—Å–Ω–æ–≤–Ω–æ–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –∫–æ–º–∞–Ω–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å eBPF-–ø—Ä–æ–≥—Ä–∞–º–º–∞–º–∏ –∏ –∫–∞—Ä—Ç–∞–º–∏, –≤—Ö–æ–¥–∏—Ç –≤ —Å–æ—Å—Ç–∞–≤ —è–¥—Ä–∞ Linux."

| –ö–æ–º–∞–Ω–¥–∞                                                  | –û–ø–∏—Å–∞–Ω–∏–µ                                                | –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è                                                 |
| -------------------------------------------------------- | ------------------------------------------------------- | ---------------------------------------------------------|
| `bpftool prog list`                                      | –í—ã–≤–æ–¥–∏—Ç —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö eBPF-–ø—Ä–æ–≥—Ä–∞–º–º.          | `bpftool prog list`                                      |
| `bpftool map list`                                       | –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≤—Å–µ –¥–æ—Å—Ç—É–ø–Ω—ã–µ eBPF-–∫–∞—Ä—Ç—ã (maps).             | `bpftool map list`                                       |
| `bpftool feature probe`                                  | –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, –∫–∞–∫–∏–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ eBPF –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —è–¥—Ä–æ.    | `bpftool feature probe`                                  |
| `bpftool net attach xdp dev eth0 obj xdp_prog.o sec xdp` | –ü—Ä–∏–∫—Ä–µ–ø–ª—è–µ—Ç XDP-–ø—Ä–æ–≥—Ä–∞–º–º—É –∫ —Å–µ—Ç–µ–≤–æ–º—É –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—É `eth0`. | `bpftool net attach xdp dev eth0 obj xdp_prog.o sec xdp` |

### `bpftrace`

!!! info "–ú–æ—â–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–≥–æ —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∞–Ω–∏—è —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º eBPF. –ü–æ–∑–≤–æ–ª—è–µ—Ç –±—ã—Å—Ç—Ä–æ –ø–∏—Å–∞—Ç—å —Å–∫—Ä–∏–ø—Ç—ã –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ —Ä–∞–±–æ—Ç—ã —Å–∏—Å—Ç–µ–º—ã."

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**

- –°–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π –ø—Ä–æ—Å—Ç–æ–π –≤—ã—Å–æ–∫–æ—É—Ä–æ–≤–Ω–µ–≤—ã–π —è–∑—ã–∫ –¥–ª—è –æ–ø–∏—Å–∞–Ω–∏—è –ø—Ä–∞–≤–∏–ª —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∏.
- –ò–¥–µ–∞–ª–µ–Ω –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏, –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∏ –±—ã—Å—Ç—Ä–æ–≥–æ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è –ø–æ–≤–µ–¥–µ–Ω–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π –∏ —è–¥—Ä–∞ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏.
- –ù–µ —Ç—Ä–µ–±—É–µ—Ç –æ—Ç–¥–µ–ª—å–Ω–æ–π –∫–æ–º–ø–∏–ª—è—Ü–∏–∏ ‚Äî —Å–∫—Ä–∏–ø—Ç—ã –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –Ω–∞–ø—Ä—è–º—É—é.

!!! example "–ü—Ä–∏–º–µ—Ä —Å–∫—Ä–∏–ø—Ç–∞ –¥–ª—è `bpftrace`"

    –≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç –≤—ã–≤–æ–¥–∏—Ç –∏–º—è –∫–∞–∂–¥–æ–≥–æ —Ñ–∞–π–ª–∞, –∫–æ—Ç–æ—Ä—ã–π –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –≤ —Å–∏—Å—Ç–µ–º–µ.

    ```c
    tracepoint:syscalls:sys_enter_openat
    {
        printf("–û—Ç–∫—Ä—ã—Ç —Ñ–∞–π–ª: %s\n", str(args->filename));
    }
    ```

### BCC

!!! info "–ö–æ–º–ø–ª–µ–∫—Å–Ω—ã–π –Ω–∞–±–æ—Ä —É—Ç–∏–ª–∏—Ç –∏ –±–∏–±–ª–∏–æ—Ç–µ–∫ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è eBPF-–ø—Ä–æ–≥—Ä–∞–º–º."

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏**:

- –í–∫–ª—é—á–∞–µ—Ç –º–Ω–æ–∂–µ—Å—Ç–≤–æ –≥–æ—Ç–æ–≤—ã—Ö –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤, –Ω–∞–ø—Ä–∏–º–µ—Ä:

    - `opensnoop` ‚Äî –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –æ—Ç–∫—Ä—ã—Ç–∏—è —Ñ–∞–π–ª–æ–≤,
    - `tcptop` ‚Äî –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ TCP-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π,
    - `execsnoop` ‚Äî –Ω–∞–±–ª—é–¥–µ–Ω–∏–µ –∑–∞ –∑–∞–ø—É—Å–∫–æ–º –ø—Ä–æ—Ü–µ—Å—Å–æ–≤.

- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –Ω–∞–ø–∏—Å–∞–Ω–∏–µ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã—Ö –ø—Ä–æ–≥—Ä–∞–º–º –Ω–∞ Python –∏–ª–∏ Lua —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —É–¥–æ–±–Ω—ã—Ö –±–∏–Ω–¥–∏–Ω–≥–æ–≤.
- **–ù–µ–¥–æ—Å—Ç–∞—Ç–æ–∫**: —Ç—Ä–µ–±—É–µ—Ç –∫–æ–º–ø–∏–ª—è—Ü–∏–∏ eBPF-–∫–æ–¥–∞ –Ω–∞ —Ü–µ–ª–µ–≤–æ–π –º–∞—à–∏–Ω–µ –∏ –Ω–∞–ª–∏—á–∏—è –∑–∞–≥–æ–ª–æ–≤–æ—á–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ —è–¥—Ä–∞, —á—Ç–æ —Å–æ–∑–¥–∞–µ—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç –≤–µ—Ä—Å–∏–∏ —è–¥—Ä–∞ Linux.

### CO-RE –∏ `libbpf`

!!! info "–°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –ø–æ–¥—Ö–æ–¥ –∫ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ eBPF-–ø—Ä–æ–≥—Ä–∞–º–º, –ø–æ–∑–≤–æ–ª—è—é—â–∏–π –∑–∞–ø—É—Å–∫–∞—Ç—å –æ–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ –∫–æ–¥ –Ω–∞ —Ä–∞–∑–Ω—ã—Ö –≤–µ—Ä—Å–∏—è—Ö —è–¥—Ä–∞ –±–µ–∑ –ø–µ—Ä–µ–∫–æ–º–ø–∏–ª—è—Ü–∏–∏."

**CO-RE (Compile Once ‚Äì Run Everywhere)**:

- –ü–æ–∑–≤–æ–ª—è–µ—Ç —Å–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞—Ç—å eBPF-–ø—Ä–æ–≥—Ä–∞–º–º—É –æ–¥–∏–Ω —Ä–∞–∑ –∏ –∑–∞–ø—É—Å–∫–∞—Ç—å –µ—ë –Ω–∞ –ª—é–±—ã—Ö –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã—Ö –≤–µ—Ä—Å–∏—è—Ö —è–¥—Ä–∞ Linux.
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç —Ñ–æ—Ä–º–∞—Ç **BTF (BPF Type Format)** –¥–ª—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–≥–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä —è–¥—Ä–∞ –∏ –∏—Ö –ø–æ–ª–µ–π –≤–æ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è.

`libbpf`:

- –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ –Ω–∞ C/C++, –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –≤ —è–¥—Ä–æ Linux, –∫–æ—Ç–æ—Ä–∞—è –æ–±–ª–µ–≥—á–∞–µ—Ç –∑–∞–≥—Ä—É–∑–∫—É, –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—é –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ eBPF-–ø—Ä–æ–≥—Ä–∞–º–º–∞–º–∏ –∏ –∫–∞—Ä—Ç–∞–º–∏.
- –û–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç —É–¥–æ–±–Ω—ã–π –∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å **eBPF**, –≤–∫–ª—é—á–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫—É **CO-RE**.

!!! example "–ü—Ä–∏–º–µ—Ä –∫–æ–¥–∞ —Å `libbpf`"

    ```c
    struct bpf_object *obj = bpf_object__open_file("prog.bpf.o", NULL);
    bpf_object__load(obj);
    int prog_fd = bpf_program__fd(bpf_object__find_program_by_name(obj, "xdp_prog"));
    bpf_set_link_xdp_fd(ifindex, prog_fd, 0);
    ```

!!! note "–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ"

    `libbpf` –≤–º–µ—Å—Ç–µ —Å CO-RE –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ –≤—ã—Ç–µ—Å–Ω—è–µ—Ç BCC –≤ –∫–∞—á–µ—Å—Ç–≤–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∞ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ —Å–µ—Ä—å–µ–∑–Ω—ã—Ö eBPF-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π.

    BCC –æ—Å—Ç–∞–µ—Ç—Å—è –ø–æ–ª–µ–∑–Ω—ã–º –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø—Ä–æ—Ç–æ—Ç–∏–ø–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≥–æ—Ç–æ–≤—ã—Ö —É—Ç–∏–ª–∏—Ç, –Ω–æ `libbpf` –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç –±–æ–ª—å—à—É—é –ø–µ—Ä–µ–Ω–æ—Å–∏–º–æ—Å—Ç—å –∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å.

---

## üîç BPF Type Format

!!! info "–ß—Ç–æ —Ç–∞–∫–æ–µ `BTF`"

    **BTF** ‚Äî —ç—Ç–æ –∫–æ–º–ø–∞–∫—Ç–Ω—ã–π –±–∏–Ω–∞—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –æ–ø–∏—Å–∞–Ω–∏—è —Ç–∏–ø–æ–≤ –¥–∞–Ω–Ω—ã—Ö, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–∑–≤–æ–ª—è–µ—Ç:
    
    - –£–ø—Ä–æ—Å—Ç–∏—Ç—å –æ—Ç–ª–∞–¥–∫—É **eBPF**-–ø—Ä–æ–≥—Ä–∞–º–º,
    - –û–±–µ—Å–ø–µ—á–∏—Ç—å —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å –º–µ–∂–¥—É —Ä–∞–∑–Ω—ã–º–∏ –≤–µ—Ä—Å–∏—è–º–∏ —è–¥—Ä–∞ (**CO-RE**),
    - –°–Ω–∏–∑–∏—Ç—å –Ω–∞–≥—Ä—É–∑–∫—É –Ω–∞ —è–¥—Ä–æ (–ø–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—é —Å DWARF).

    –î–∞–Ω–Ω—ã–µ –±–∏–Ω–∞—Ä–Ω—ã–µ —Ñ–∞–π–ª—ã —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ `/sys/kernel/btf/`.

!!! info "–ñ–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª `BTF`"

    1. –ö–æ–º–ø–∏–ª—è—Ç–æ—Ä (`Clang`) —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞—Ö, —Ñ—É–Ω–∫—Ü–∏—è—Ö –∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –≤ `.BTF`-—Å–µ–∫—Ü–∏—é ELF-—Ñ–∞–π–ª–∞

        –ü—Ä–∏–º–µ—Ä:

        ```c
        struct event {  
            u64 timestamp;  
            u32 pid;  
            char comm[16];  
        }; 
        ```

        –î–∞–ª–µ–µ —ç—Ç–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –±—É–¥–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∫–∞–∫ –±–∏–Ω–∞—Ä–Ω—ã–π `BTF` —Ñ–∞–π–ª.

        –î–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ `BTF` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–æ–º–∞–Ω–¥–∞ –Ω–∏–∂–µ.

        ```bash
        clang -g -O2 -target bpf -c prog.c -o prog.o
        # -g –¥–æ–±–∞–≤–ª—è–µ—Ç BTF –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
        ```

    2. –ó–∞–≥—Ä—É–∑–∫–∞ –≤ —è–¥—Ä–æ

        –ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ **eBPF**-–ø—Ä–æ–≥—Ä–∞–º–º—ã `BTF`-–¥–∞–Ω–Ω—ã–µ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –≤–º–µ—Å—Ç–µ —Å –±–∞–π—Ç-–∫–æ–¥–æ–º.

        –Ø–¥—Ä–æ —Ö—Ä–∞–Ω–∏—Ç –∏—Ö –≤ `/sys/kernel/btf/vmlinux` (–¥–ª—è –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã—Ö —Ç–∏–ø–æ–≤) –∏ –≤ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä–∞—Ö –¥–ª—è –ø—Ä–æ–≥—Ä–∞–º–º.

    3. –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã (`bpftool`, `bpftrace`) –∏—Å–ø–æ–ª—å–∑—É—é—Ç BTF

        –ù–∞–ø—Ä–∏–º–µ—Ä –¥–ª—è:

        - –ü–µ—á–∞—Ç–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä (`bpftool map dump` —Å —á–µ–ª–æ–≤–µ–∫–æ-—á–∏—Ç–∞–µ–º—ã–º–∏ –ø–æ–ª—è–º–∏).
        - –ü—Ä–æ–≤–µ—Ä–∫–∏ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ –º–µ–∂–¥—É —Ä–∞–∑–Ω—ã–º–∏ –≤–µ—Ä—Å–∏—è–º–∏ —è–¥—Ä–∞ (**CO-RE**).

!!! note "–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ"

    –ú–æ–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–∞–∫–∏–µ `BTF` –∑–∞–≥—Ä—É–∂–µ–Ω—ã –≤ —Å–∏—Å—Ç–µ–º—É –∏—Å–ø–æ–ª—å–∑—É—è –∫–æ–º–∞–Ω–¥—É –Ω–∏–∂–µ.

    ```bash
    bpftool btf show
    ```
