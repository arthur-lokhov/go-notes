# üìÅ Union File System (UFS)
<!--markdownlint-disable MD046-->

–ß—Ç–æ–±—ã –ø–æ–Ω–∏–º–∞—Ç—å, –∫–∞–∫ —Ä–∞–±–æ—Ç–∞—é—Ç Docker-–æ–±—Ä–∞–∑—ã –∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã, –Ω—É–∂–Ω–æ —Ä–∞–∑–æ–±—Ä–∞—Ç—å—Å—è —Å UnionFS - —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º–æ–π, –∫–æ—Ç–æ—Ä–∞—è –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –≤ Docker.

---

## üîπ –ß—Ç–æ —Ç–∞–∫–æ–µ UFS

**Union File System (UFS)** ‚Äî —ç—Ç–æ —Å–ø–æ—Å–æ–± **–∫–∞—Å–∫–∞–¥–Ω–æ–≥–æ –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏—è** –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Ñ–∞–π–ª–æ–≤—ã—Ö —Å–∏—Å—Ç–µ–º (—Å–ª–æ—ë–≤) –≤ –æ–¥–Ω—É –≤–∏—Ä—Ç—É–∞–ª—å–Ω—É—é.

–ö–∞–∂–¥—ã–π —Å–ª–æ–π –º–æ–∂–µ—Ç –±—ã—Ç—å –∫–∞–∫ `read-only`, —Ç–∞–∫ –∏ `read-write`, –Ω–æ –≤ —Ä–∞–º–∫–∞—Ö –æ–¥–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è –¥–æ–ø—É—Å–∫–∞—é—Ç—Å—è **—Ç–æ–ª—å–∫–æ –≤ –≤–µ—Ä—Ö–Ω–µ–º (RW) —Å–ª–æ–µ**.

–í Docker UnionFS –ø–æ–∑–≤–æ–ª—è–µ—Ç:

- –°–æ–±–∏—Ä–∞—Ç—å –æ–±—Ä–∞–∑—ã –∏–∑ —Å–ª–æ—ë–≤.
- –ü–æ–≤—Ç–æ—Ä–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–ª–æ–∏ –≤ —Ä–∞–∑–Ω—ã—Ö –æ–±—Ä–∞–∑–∞—Ö.
- –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ —Ö—Ä–∞–Ω–∏—Ç—å –¥–∞–Ω–Ω—ã–µ, –∏–∑–±–µ–≥–∞—è –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è.

!!! info

    –í–∏—Ä—Ç—É–∞–ª—å–Ω–∞—è —Ñ–∞–π–ª–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞, —Å–æ–∑–¥–∞–Ω–Ω–∞—è —Å –ø–æ–º–æ—â—å—é UnionFS, –≤—ã–≥–ª—è–¥–∏—Ç –∫–∞–∫ –æ–±—ã—á–Ω–∞—è, –Ω–æ –Ω–∞ –¥–µ–ª–µ ‚Äî —ç—Ç–æ —Å—Ç–µ–∫ –∏–∑ —Å–ª–æ—ë–≤, –Ω–∞–ª–æ–∂–µ–Ω–Ω—ã—Ö –¥—Ä—É–≥ –Ω–∞ –¥—Ä—É–≥–∞.

---

## üî¢ –°–ª–æ–∏ –æ–±—Ä–∞–∑–∞

–ö–∞–∂–¥—ã–π —Å–ª–æ–π –æ–±—Ä–∞–∑–∞ —Å–æ–∑–¥–∞—ë—Ç—Å—è –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ.

–ü—Ä–∏–º–µ—Ä:

1. `FROM ubuntu` ‚Üí –±–∞–∑–æ–≤—ã–π —Å–ª–æ–π (–±–∞–∑–æ–≤—ã–π –æ–±—Ä–∞–∑).
2. `RUN apt update` ‚Üí —Å–ª–æ–π —Å –∏–∑–º–µ–Ω—ë–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º–æ–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, –æ–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–µ –ø–∞–∫–µ—Ç—ã).
3. `COPY . /app` ‚Üí –µ—â—ë –æ–¥–∏–Ω —Å–ª–æ–π, –¥–æ–±–∞–≤–ª—è—é—â–∏–π —Ñ–∞–π–ª—ã –ø—Ä–æ–µ–∫—Ç–∞.

**–ò—Ç–æ–≥**: –¢—Ä–∏ read-only —Å–ª–æ—è, –æ–±—ä–µ–¥–∏–Ω—ë–Ω–Ω—ã–µ –≤ –æ–¥–Ω—É –≤–∏—Ä—Ç—É–∞–ª—å–Ω—É—é —Ñ–∞–π–ª–æ–≤—É—é —Å–∏—Å—Ç–µ–º—É.
–û–±—Ä–∞–∑ ‚Äî —ç—Ç–æ –∏ –µ—Å—Ç—å —Ç–∞–∫–∞—è –æ–±—ä–µ–¥–∏–Ω—ë–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞, —Å–æ–±—Ä–∞–Ω–Ω–∞—è –∏–∑ —Å–ª–æ—ë–≤.

---

## üì¶ –ö–∞–∫ —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã —Å UFS

–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å–æ–∑–¥–∞—ë—Ç—Å—è –ø–æ–≤–µ—Ä—Ö –æ–±—Ä–∞–∑–∞, –¥–æ–±–∞–≤–ª—è—è **read-write —Å–ª–æ–π (RW Layer)**, –∫–æ—Ç–æ—Ä—ã–π:

- –†–∞–∑—Ä–µ—à–∞–µ—Ç –∑–∞–ø–∏—Å—å –∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è (–≤ –æ—Ç–ª–∏—á–∏–µ –æ—Ç read-only —Å–ª–æ—ë–≤ –æ–±—Ä–∞–∑–∞).
- –Ø–≤–ª—è–µ—Ç—Å—è –≤—Ä–µ–º–µ–Ω–Ω—ã–º: –∏—Å—á–µ–∑–∞–µ—Ç –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞.
- –ü–æ–∑–≤–æ–ª—è–µ—Ç "–ø—Ä–∏—Ç–≤–æ—Ä—è—Ç—å—Å—è", —á—Ç–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∑–∞—Ç—Ä–æ–Ω—É–ª–∏ –Ω–∏–∂–Ω–∏–µ —Å–ª–æ–∏, —Ö–æ—Ç—è –Ω–∞ –¥–µ–ª–µ –æ–Ω–∏ —Ç–æ–ª—å–∫–æ –≤ RW-—Å–ª–æ–µ.

–ï—Å–ª–∏ —Ñ–∞–π–ª –∏–∑ read-only —Å–ª–æ—è –∏–∑–º–µ–Ω—è–µ—Ç—Å—è ‚Äî –æ–Ω **–∫–æ–ø–∏—Ä—É–µ—Ç—Å—è –≤ RW-—Å–ª–æ–π (copy-on-write)**, –∏ –∏–º–µ–Ω–Ω–æ –∏–∑–º–µ–Ω—ë–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –≤–∏–¥–∏–º–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—É.

---

## ‚öôÔ∏è –†–µ–∞–ª–∏–∑–∞—Ü–∏–∏ UnionFS

Docker –Ω–µ —Ä–µ–∞–ª–∏–∑—É–µ—Ç UnionFS —Å–∞–º –ø–æ —Å–µ–±–µ ‚Äî –æ–Ω –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **–æ–¥–Ω—É –∏–∑ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã—Ö —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–π** –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ —Ö–æ—Å—Ç–∞:

### üìä –¢–∞–±–ª–∏—Ü–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–π UnionFS –≤ Docker

| –î—Ä–∞–π–≤–µ—Ä                      | –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —è–¥—Ä–∞                     | –ú–∞–∫—Å. –∫–æ–ª-–≤–æ —Å–ª–æ—ë–≤                                   | –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞                                              | –ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏                                                                            | –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å                              |
| ---------------------------- | ---------------------------------- | ---------------------------------------------------- | --------------------------------------------------------- | ------------------------------------------------------------------------------------- | ----------------------------------------------- |
| **OverlayFS** / **overlay2** | Linux 3.18+ (overlay2: 4.0+)       | **128** —Å–ª–æ—ë–≤ (–≤ overlay2)                           | –ë—ã—Å—Ç—Ä—ã–π, –ø—Ä–æ—Å—Ç–æ–π, –Ω–∞—Ç–∏–≤–Ω—ã–π –¥–ª—è Linux                      | overlay (—Å—Ç–∞—Ä—ã–π) –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ —Å whiteout-—Ñ–∞–π–ª–∞–º–∏, overlay2 ‚Äî –∏—Å–ø—Ä–∞–≤–ª—è–µ—Ç | ‚úÖ –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é                    |
| **AUFS**                     | –¢—Ä–µ–±—É–µ—Ç –ø–∞—Ç—á–µ–π —è–¥—Ä–∞ (–≤–Ω–µ mainline) | **127** —Å–ª–æ—ë–≤                                        | –ü—Ä–æ–≤–µ—Ä–µ–Ω –≤—Ä–µ–º–µ–Ω–µ–º, –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≥–ª—É–±–æ–∫—É—é –∏–µ—Ä–∞—Ä—Ö–∏—é         | –ù–µ –≤—Ö–æ–¥–∏—Ç –≤ –æ—Å–Ω–æ–≤–Ω–æ–µ —è–¥—Ä–æ, —Å–ª–æ–∂–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞                                          | –¢–æ–ª—å–∫–æ –µ—Å–ª–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–∞ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å –∏–ª–∏ legacy |
| **Btrfs**                    | –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –≤ —è–¥—Ä–µ Linux             | **–ù–µ—Ç —è–≤–Ω–æ–≥–æ –ª–∏–º–∏—Ç–∞**, –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—ã          | –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Å–Ω–∞–ø—à–æ—Ç–æ–≤, –∫–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è, —Å–∂–∞—Ç–∏—è                 | –¢—Ä–µ–±—É–µ—Ç Btrfs –∫–∞–∫ –æ—Å–Ω–æ–≤–Ω–æ–π –§–°, –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω—ã–º –ø–æ–¥ –Ω–∞–≥—Ä—É–∑–∫–æ–π                  | –ï—Å–ª–∏ –Ω—É–∂–Ω–∞ –ø—Ä–æ–¥–≤–∏–Ω—É—Ç–∞—è —Ä–∞–±–æ—Ç–∞ —Å –æ–±—Ä–∞–∑–∞–º–∏        |
| **ZFS**                      | –¢—Ä–µ–±—É–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏      | **–ù–µ—Ç –ª–∏–º–∏—Ç–∞ –Ω–∞ —Å–ª–æ–∏**, –∑–∞–≤–∏—Å–∏—Ç –æ—Ç ZFS               | –ù–∞–¥—ë–∂–Ω–æ—Å—Ç—å, –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è, —Å–Ω–∞–ø—à–æ—Ç—ã, —Å–∂–∞—Ç–∏–µ                | –°–ª–æ–∂–Ω–æ—Å—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏, –Ω–µ –≤–æ –≤—Å–µ—Ö –¥–∏—Å—Ç—Ä–∏–±—É—Ç–∏–≤–∞—Ö –¥–æ—Å—Ç—É–ø–µ–Ω                                | –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ —Å–ª—É—á–∞–∏, —Ç—Ä–µ–±—É—é—â–∏–µ –Ω–∞–¥—ë–∂–Ω–æ—Å—Ç–∏        |
| **devicemapper**             | Linux 2.6.9+                       | –î–æ **128** —Å–ª–æ—ë–≤ (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ thin pool) | –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –±–ª–æ—á–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ, –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å LVM | –ú–µ–¥–ª–µ–Ω–Ω—ã–π, —Å–ª–æ–∂–Ω—ã–π –≤ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–∏, —Ç—Ä–µ–±—É–µ—Ç —Ç–æ–Ω–∫–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏                             | –õ–µ–≥–∞—Å–∏ –∏–ª–∏ —Å–ø–µ—Ü–∏—Ñ–∏—á–µ—Å–∫–∏–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è              |

### üîé –ß—Ç–æ –≤–∞–∂–Ω–æ –ø–æ–º–Ω–∏—Ç—å

1. **Overlay2** ‚Äî –Ω–∞–∏–±–æ–ª–µ–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–∞—è –∏ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –¥–ª—è —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Å–∏—Å—Ç–µ–º.
2. **AUFS** –∏–º–µ–µ—Ç –∂—ë—Å—Ç–∫–æ–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –≤ 127 —Å–ª–æ—ë–≤, —á—Ç–æ –º–æ–∂–µ—Ç —Å—Ç–∞—Ç—å –ø—Ä–æ–±–ª–µ–º–æ–π –ø—Ä–∏ –≥–ª—É–±–æ–∫–æ–π Dockerfile-–∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏.
3. **Btrfs/ZFS** –¥–∞—é—Ç –º–∞–∫—Å–∏–º—É–º –≥–∏–±–∫–æ—Å—Ç–∏, –Ω–æ –∏—Ö —Å—Ç–æ–∏—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å, —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —Ç—ã —Ö–æ—Ä–æ—à–æ —Ä–∞–∑–±–∏—Ä–∞–µ—à—å—Å—è –≤ –∏—Ö –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∏ —É–º–µ–µ—à—å –∏—Ö –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å.
4. **devicemapper** –º–æ–∂–µ—Ç –±—ã—Ç—å –ø–æ–ª–µ–∑–µ–Ω –≤ Red Hat-–æ–∫—Ä—É–∂–µ–Ω–∏—è—Ö –∏–ª–∏ –µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è LVM-–±–∞–∑–æ–≤–∞—è –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞.

### üîç –ö–∞–∫ —É–∑–Ω–∞—Ç—å, –∫–∞–∫–æ–π –¥—Ä–∞–π–≤–µ—Ä –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è

–í—ã–ø–æ–ª–Ω–∏ –∫–æ–º–∞–Ω–¥—É:

```bash
docker info
```

–í –≤—ã–≤–æ–¥–µ –Ω–∞–π–¥–∏ —Å—Ç—Ä–æ–∫—É:

```bash
Storage Driver: overlay2
```

–≠—Ç–æ –∏ –µ—Å—Ç—å —Ç–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è UnionFS –Ω–∞ —Ç–≤–æ–µ–π —Å–∏—Å—Ç–µ–º–µ.

### üîÅ –ö–∞–∫ –∏–∑–º–µ–Ω–∏—Ç—å –¥—Ä–∞–π–≤–µ—Ä

–ß—Ç–æ–±—ã –∏–∑–º–µ–Ω–∏—Ç—å –¥—Ä–∞–π–≤–µ—Ä —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã, —Ç—Ä–µ–±—É–µ—Ç—Å—è —Å–Ω–∞—á–∞–ª–∞ –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Docker –∏ –æ—á–∏—Å—Ç–∏—Ç—å –µ–≥–æ –¥–∞–Ω–Ω—ã–µ:

```bash
sudo systemctl stop docker
sudo rm -rf /var/lib/docker
```

–ê –∑–∞—Ç–µ–º —É–∫–∞–∑–∞—Ç—å –Ω—É–∂–Ω—ã–π –¥—Ä–∞–π–≤–µ—Ä –≤ `/etc/docker/daemon.json`:

```json
{
    // ... –î—Ä—É–≥–∏–µ –æ–ø—Ü–∏–∏
    "storage-driver": "overlay2"
}
```

–ò –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å Docker.

```bash
sudo systemctl start docker
```

---

> –ê–±–±—Ä–µ–≤–∏–∞—Ç—É—Ä–∞ UFS –≤–æ –º–Ω–æ–≥–∏—Ö —Å–ª—É—á–∞—è—Ö –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –æ–±–æ–∑–Ω–∞—á–µ–Ω–∏—è Unix File System.
> –§–∞–π–ª–æ–≤—É—é —Å–∏—Å—Ç–µ–º—É —Å –∫–∞—Å–∫–æ–¥–Ω–æ-–æ–±—ä–µ–¥–∏–Ω–µ–Ω–Ω—ã–º –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º —á–∞—â–µ –æ–±–æ–∑–Ω–∞—á–∞—é—Ç –∫–∞–∫ UnionFS.
