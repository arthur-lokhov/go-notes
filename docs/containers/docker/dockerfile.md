---
title: Dockerfile
---

# üì¶ Dockerfile

!!! question "–ß—Ç–æ —Ç–∞–∫–æ–µ Dockerfile"

    **Dockerfile** ‚Äî —ç—Ç–æ —Å—Ü–µ–Ω–∞—Ä–∏–π, –æ–ø–∏—Å—ã–≤–∞—é—â–∏–π –∫–∞–∫ —Å–æ–±—Ä–∞—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–Ω—ã–π –æ–±—Ä–∞–∑.

    Docker –ø–æ—à–∞–≥–æ–≤–æ –≤—ã–ø–æ–ª–Ω—è–µ—Ç –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –≤ –Ω—ë–º, —Å–æ–∑–¥–∞–≤–∞—è —Å–ª–æ–∏ –∏ —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –æ–±—Ä–∞–∑.

---

## üìÑ –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ Dockerfile

| –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
| :--- | :--- |
| `ADD` | –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è `COPY`: –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç `.tar`, URL, –∞–≤—Ç–æ-—Ä–∞—Å–ø–∞–∫–æ–≤–∫—É. |
| `ARG` | –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ **–Ω–∞ —ç—Ç–∞–ø–µ —Å–±–æ—Ä–∫–∏** (–Ω–µ –ø–æ–ø–∞–¥–∞—é—Ç –≤ –æ–±—Ä–∞–∑). |
| `CMD` | –ö–æ–º–∞–Ω–¥–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞. |
| `COPY` | –ö–æ–ø–∏—Ä—É–µ—Ç —Ñ–∞–π–ª—ã/–∫–∞—Ç–∞–ª–æ–≥–∏ –∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –≤–Ω—É—Ç—Ä—å –æ–±—Ä–∞–∑–∞. |
| `ENTRYPOINT` | –û—Å–Ω–æ–≤–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞ (–Ω–µ –∑–∞–º–µ–Ω—è–µ—Ç—Å—è –ø—Ä–∏ `docker run <args>`). |
| `ENV` | –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤–Ω—É—Ç—Ä–∏ –æ–±—Ä–∞–∑–∞. |
| `EXPOSE` | –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä—É–µ—Ç –ø–æ—Ä—Ç (–Ω–µ –¥–µ–ª–∞–µ—Ç –µ–≥–æ –¥–æ—Å—Ç—É–ø–Ω—ã–º –∏–∑–≤–Ω–µ). |
| `FROM` | –ë–∞–∑–æ–≤—ã–π –æ–±—Ä–∞–∑ (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–∞—è –ø–µ—Ä–≤–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è). |
| `HEALTHCHECK` | –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞. |
| `LABEL` | –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ (–≤–µ—Ä—Å–∏—è, –∞–≤—Ç–æ—Ä –∏ –ø—Ä.). |
| `ONBUILD` | –ö–æ–º–∞–Ω–¥–∞, –∫–æ—Ç–æ—Ä–∞—è –±—É–¥–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ –æ–±—Ä–∞–∑–∞ –∫–∞–∫ `FROM`. |
| `RUN` | –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥—ã –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ —Å–±–æ—Ä–∫–∏ (—Å–æ–∑–¥–∞—ë—Ç —Å–ª–æ–π). |
| `SHELL` | –ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∏—Å–ø–æ–ª—å–∑—É–µ–º–æ–π shell –¥–ª—è `RUN`, `CMD`. |
| `STOPSIGNAL` | –°–∏–≥–Ω–∞–ª –¥–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –ø—Ä–æ—Ü–µ—Å—Å–∞ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ. |
| `USER` | –£–∫–∞–∑—ã–≤–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –æ—Ç –∏–º–µ–Ω–∏ –∫–æ—Ç–æ—Ä–æ–≥–æ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –∫–æ–º–∞–Ω–¥—ã. |
| `VOLUME` | –û–±—ä—è–≤–ª—è–µ—Ç —Ç–æ—á–∫—É –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è volume. |
| `WORKDIR` | –†–∞–±–æ—á–∞—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –¥–ª—è –≤—Å–µ—Ö —Å–ª–µ–¥—É—é—â–∏—Ö –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π. |

### ü§î ADD vs COPY

!!! info "–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å ADD"

    –û–±–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –∫–æ–ø–∏—Ä—É—é—Ç —Ñ–∞–π–ª—ã –≤ –æ–±—Ä–∞–∑, –Ω–æ `ADD` –∏–º–µ–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—É—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å:

    - **`COPY`**: –ü—Ä–æ—Å—Ç–æ –∫–æ–ø–∏—Ä—É–µ—Ç –ª–æ–∫–∞–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã –∏ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏.
    - **`ADD`**:

        - –ö–æ–ø–∏—Ä—É–µ—Ç –ª–æ–∫–∞–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã.
        - **–†–∞—Å–ø–∞–∫–æ–≤—ã–≤–∞–µ—Ç `.tar` –∞—Ä—Ö–∏–≤—ã** –Ω–∞ –ª–µ—Ç—É.
        - **–°–∫–∞—á–∏–≤–∞–µ—Ç —Ñ–∞–π–ª—ã –ø–æ URL**.

!!! success "–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ COPY"

    **–í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `COPY`**, –µ—Å–ª–∏ –Ω–µ –Ω—É–∂–Ω–∞ —Å–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å `ADD`.

    –ü—Ä–∏—á–∏–Ω—ã:

    - **–ü—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ—Å—Ç—å**: `COPY` –¥–µ–ª–∞–µ—Ç —Ç–æ–ª—å–∫–æ –æ–¥–Ω–æ ‚Äî –∫–æ–ø–∏—Ä—É–µ—Ç.
    - **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**: `ADD` —Å URL –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –∑–∞–≥—Ä—É–∑–∫–µ –≤—Ä–µ–¥–æ–Ω–æ—Å–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤.
    - **–ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ**: `ADD` —Å URL —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç –∫–µ—à —á–∞—â–µ, —á–µ–º `COPY`.

### ‚öôÔ∏è FROM –∏ ARG

!!! note "–î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π –±–∞–∑–æ–≤—ã–π –æ–±—Ä–∞–∑"

    –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è `ARG` –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –¥–æ `FROM`, —á—Ç–æ–±—ã —Å–¥–µ–ª–∞—Ç—å –±–∞–∑–æ–≤—ã–π –æ–±—Ä–∞–∑ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–º.

    ```dockerfile
    ARG TAG=latest
    FROM alpine:${TAG}
    ```

    –û–¥–Ω–∞–∫–æ `ARG`, –æ–±—ä—è–≤–ª–µ–Ω–Ω—ã–π –¥–æ `FROM`, –Ω–µ –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –≤ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è—Ö –ø–æ—Å–ª–µ `FROM`.

    –ß—Ç–æ–±—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –µ–≥–æ –¥–∞–ª—å—à–µ, –µ–≥–æ –Ω—É–∂–Ω–æ –ø–æ–≤—Ç–æ—Ä–Ω–æ –æ–±—ä—è–≤–∏—Ç—å:

    ```dockerfile
    ARG TAG=latest
    FROM alpine:${TAG}

    ARG TAG
    RUN echo "Tag is ${TAG}"
    ```

### ‚öôÔ∏è CMD vs ENTRYPOINT

!!! info "–†–∞–∑–Ω–∏—Ü–∞ –≤ –ø–æ–≤–µ–¥–µ–Ω–∏–∏"

    –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ **CMD** –∏ **ENTRYPOINT** –æ–ø—Ä–µ–¥–µ–ª—è—é—Ç, —á—Ç–æ –±—É–¥–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞.

    –†–∞–∑–Ω–∏—Ü–∞:

    - **CMD** –∑–∞–º–µ–Ω—è–µ—Ç—Å—è –∞—Ä–≥—É–º–µ–Ω—Ç–∞–º–∏ –≤ `docker run`.
    - **ENTRYPOINT** ‚Äî —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞, CMD —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –µ—ë –∞—Ä–≥—É–º–µ–Ω—Ç–∞–º–∏.

!!! example "–ö–æ–º–±–∏–Ω–∞—Ü–∏—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π CMD –∏ ENTRYPOINT"

    ```Dockerfile
    ENTRYPOINT ["echo"]
    CMD ["Hello"]
    ```

    –ï—Å–ª–∏ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –∫–æ–º–∞–Ω–¥—É –Ω–∏–∂–µ, —Ç–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º –±—É–¥–µ—Ç `echo World`.

    ```bash
    docker run myimage World
    ```

### ‚öôÔ∏è RUN –∏ –ø—Ä–æ—Ü–µ—Å—Å—ã

!!! warning "–ñ–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª RUN"

    RUN –≤—ã–ø–æ–ª–Ω–∏—Ç—Å—è –≤–æ –≤—Ä–µ–º–µ–Ω–Ω–æ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ –Ω–∞ —ç—Ç–∞–ø–µ —Å–±–æ—Ä–∫–∏ –∏ –∑–∞–≤–µ—Ä—à–∏—Ç—Å—è ‚Äî –ø—Ä–æ—Ü–µ—Å—Å –Ω–µ –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –≤ —Ñ–∏–Ω–∞–ª—å–Ω–æ–º –æ–±—Ä–∞–∑–µ.

### üß® ONBUILD

!!! info "–û—Ç–ª–æ–∂–µ–Ω–Ω—ã–π –∑–∞–ø—É—Å–∫"

    –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è `ONBUILD` –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è **–Ω–µ —Å—Ä–∞–∑—É**, –∞ **—Ç–æ–ª—å–∫–æ –∫–æ–≥–¥–∞ –æ–±—Ä–∞–∑ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–∞–∫ –±–∞–∑–æ–≤—ã–π (`FROM`) –≤ –¥—Ä—É–≥–æ–º Dockerfile**.

    –≠—Ç–æ —É–¥–æ–±–Ω–æ, —á—Ç–æ–±—ã –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ç–∏–ø–æ–≤—ã–µ –¥–µ–π—Å—Ç–≤–∏—è, –Ω–∞–ø—Ä–∏–º–µ—Ä:

    ```dockerfile
    ONBUILD COPY . /app
    ONBUILD RUN npm install
    ```

    –¢–∞–∫–æ–π –æ–±—Ä–∞–∑ –ø—Ä–∏ —Å–±–æ—Ä–∫–µ **–Ω–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞–µ—Ç**, –Ω–æ –µ—Å–ª–∏ –∫—Ç–æ-—Ç–æ –Ω–∞–ø–∏—à–µ—Ç:

    ```dockerfile
    FROM my-base-image
    ```

    ‚Äî —Ç–æ —Å—Ä–∞–±–æ—Ç–∞—é—Ç –≤—Å–µ `ONBUILD`-–∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏.


!!! danger "–ù–µ–ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ ONBUILD"

    –•–æ—Ç—è `ONBUILD` –≤—ã–≥–ª—è–¥–∏—Ç —É–¥–æ–±–Ω–æ, –Ω–∞ –ø—Ä–∞–∫—Ç–∏–∫–µ:

    - **–ù–µ–ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ**: –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç "–º–∞–≥–∏—á–µ—Å–∫–∏" –≤ —á—É–∂–æ–º Dockerfile.
    - **–¢—Ä—É–¥–Ω–æ –æ—Ç–ª–∞–∂–∏–≤–∞—Ç—å**, –æ—Å–æ–±–µ–Ω–Ω–æ –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö.
    - **–û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ –≤ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏**: –Ω–µ–ª—å–∑—è –ø–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–æ–≤–∞—Ç—å `COPY`, `ARG`, `ENV` –∏ —Ç.–ø.

    –í —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ:

    - –ø—Ä–æ–µ–∫—Ç –º–æ–∂–µ—Ç "—Å–ª–æ–º–∞—Ç—å—Å—è" –ø—Ä–∏ –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω–æ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –±–∞–∑–æ–≤–æ–≥–æ –æ–±—Ä–∞–∑–∞.
    - –ø–æ–≤–µ–¥–µ–Ω–∏–µ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –Ω–µ—è–≤–Ω—ã–º ‚Äî —Ç—Ä—É–¥–Ω–æ —á–∏—Ç–∞—Ç—å –∏ —Å–æ–ø—Ä–æ–≤–æ–∂–¥–∞—Ç—å.

!!! info "–ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∞—è —Å–ø—Ä–∞–≤–∫–∞"

    Docker Hub —Ä–∞–Ω—å—à–µ –ø—Ä–µ–¥–ª–∞–≥–∞–ª –æ–±—Ä–∞–∑—ã —Å –ø–æ—Å—Ç—Ñ–∏–∫—Å–æ–º `-onbuild` (–Ω–∞–ø—Ä–∏–º–µ—Ä, `node:onbuild`, `python:onbuild`), –Ω–æ:

    - –û–Ω–∏ **–æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ *[—É—Å—Ç–∞—Ä–µ–ª–∏ –∏ –±–æ–ª—å—à–µ –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è](https://github.com/docker-library/official-images/issues/2076)***.
    - –ù–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö CI/CD –ø–∞–π–ø–ª–∞–π–Ω–∞—Ö.
    - –ù–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É—é—Ç—Å—è –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞.

### ‚öôÔ∏è STOPSIGNAL

!!! info "Graceful Shutdown"

    –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è `STOPSIGNAL` —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Å–∏—Å—Ç–µ–º–Ω—ã–π —Å–∏–≥–Ω–∞–ª, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—É –¥–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –µ–≥–æ —Ä–∞–±–æ—Ç—ã.

    –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `SIGTERM`.

    –≠—Ç–æ –ø–æ–ª–µ–∑–Ω–æ, –µ—Å–ª–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ç—Ä–µ–±—É–µ—Ç —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ–≥–æ —Å–∏–≥–Ω–∞–ª–∞ –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ graceful shutdown.

    ```dockerfile
    STOPSIGNAL SIGINT
    ```

### ü©∫ HEALTHCHECK

!!! abstract "üéØ –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ HEALTHCHECK"

    **HEALTHCHECK** –Ω—É–∂–µ–Ω, —á—Ç–æ–±—ã:

    - –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å, –∂–∏–≤ –ª–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –≤–Ω—É—Ç—Ä–∏.
    - Kubernetes –º–æ–≥ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä, –µ—Å–ª–∏ —Ç–æ—Ç –∑–∞–≤–∏—Å.
    - –ü—Ä–æ–≤–µ—Ä—è—Ç—å —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.

!!! example "–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ HEALTHCHECK"

    ```dockerfile
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
    HEALTHCHECK --interval=10s --timeout=5s --start-period=5s --retries=3 \
      CMD ["curl", "-f", "http://localhost:8080/health"]
    ```

---

## üî© –û–ø—Ü–∏–∏ –¥–ª—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π

!!! info "–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ñ–ª–∞–≥–∏"
    –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ `RUN`, `COPY` –∏ `ADD` –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç —Ñ–ª–∞–≥–∏, —Ä–∞—Å—à–∏—Ä—è—é—â–∏–µ –∏—Ö —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å.

### ‚öôÔ∏è –û–ø—Ü–∏–∏ –¥–ª—è `RUN`

| –§–ª–∞–≥ | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
| :--- | :--- |
| `--device` | –ü–µ—Ä–µ–¥–∞–µ—Ç —Ö–æ—Å—Ç–æ–≤–æ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä (—Ç—Ä–µ–±—É–µ—Ç `seccomp`/`apparmor`). |
| `--mount` | –ú–æ–Ω—Ç–∏—Ä—É–µ—Ç —Ñ–∞–π–ª–æ–≤—ã–µ —Å–∏—Å—Ç–µ–º—ã –±–µ–∑ —Å–æ–∑–¥–∞–Ω–∏—è —Å–ª–æ–µ–≤ (`bind`, `cache`, `tmpfs`, `secret`, `ssh`). |
| `--network` | –£–ø—Ä–∞–≤–ª—è–µ—Ç —Å–µ—Ç–µ–≤–æ–π –∏–∑–æ–ª—è—Ü–∏–µ–π (`default`, `none`, `host`). |
| `--security` | –£–ø—Ä–∞–≤–ª—è–µ—Ç —Ä–µ–∂–∏–º–æ–º –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ (`insecure`, `sandbox`). (BuildKit) |

!!! example "–ü—Ä–∏–º–µ—Ä—ã –¥–ª—è `RUN`"

    ```dockerfile
    # –ú–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–µ—à–∞ –¥–ª—è apt
    RUN --mount=type=cache,target=/var/cache/apt apt-get update

    # –ú–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–µ–∫—Ä–µ—Ç–∞
    RUN --mount=type=secret,id=mysecret,target=/etc/secret cat /etc/secret

    # –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥—ã –±–µ–∑ —Å–µ—Ç–∏
    RUN --network=none ping 8.8.8.8
    ```

### ‚öôÔ∏è –û–ø—Ü–∏–∏ –¥–ª—è `COPY` –∏ `ADD`

| –§–ª–∞–≥ | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ | `COPY` | `ADD` |
| :--- | :--- | :---: | :---: |
| `--chown` / `--chmod` | –ò–∑–º–µ–Ω—è–µ—Ç –≤–ª–∞–¥–µ–ª—å—Ü–∞ –∏ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞. | ‚úÖ | ‚úÖ |
| `--link` | –°–æ–∑–¥–∞–µ—Ç —Å–∏–º–≤–æ–ª–∏—á–µ—Å–∫–∏–µ —Å—Å—ã–ª–∫–∏ –≤–º–µ—Å—Ç–æ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è. | ‚úÖ | ‚úÖ |
| `--exclude` | –ò—Å–∫–ª—é—á–∞–µ—Ç —Ñ–∞–π–ª—ã –ø–æ —à–∞–±–ª–æ–Ω—É. | ‚úÖ | ‚úÖ |
| `--from` | –ö–æ–ø–∏—Ä—É–µ—Ç —Ñ–∞–π–ª—ã –∏–∑ –ø—Ä–µ–¥—ã–¥—É—â–µ–π —Å—Ç–∞–¥–∏–∏ —Å–±–æ—Ä–∫–∏. | ‚úÖ | ‚ùå |
| `--parents` | –°–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π. | ‚úÖ | ‚ùå |
| `--keep-git-dir` | –°–æ—Ö—Ä–∞–Ω—è–µ—Ç `.git` –ø—Ä–∏ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–∏ –∏–∑ Git-—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è. (BuildKit) | ‚ùå | ‚úÖ |
| `--checksum` | –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω—É—é —Å—É–º–º—É —Ñ–∞–π–ª–∞. | ‚ùå | ‚úÖ |

!!! example "–ü—Ä–∏–º–µ—Ä—ã –¥–ª—è `COPY` –∏ `ADD`"

    ```dockerfile
    # –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Å –∏–∑–º–µ–Ω–µ–Ω–∏–µ–º –≤–ª–∞–¥–µ–ª—å—Ü–∞
    COPY --chown=app:app ./src /app/src

    # –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–∑ –¥—Ä—É–≥–æ–π —Å—Ç–∞–¥–∏–∏
    COPY --from=builder /app/binary /usr/local/bin/

    # –°–∫–∞—á–∏–≤–∞–Ω–∏–µ –∏ –ø—Ä–æ–≤–µ—Ä–∫–∞ checksum
    ADD --checksum=sha256:abcdef... https://example.com/file.tar.gz /tmp/
    ```

---

## üîÅ –ö–æ–Ω—Ç–µ–∫—Å—Ç —Å–±–æ—Ä–∫–∏

!!! question "–ß—Ç–æ —Ç–∞–∫–æ–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç"

    **–ö–æ–Ω—Ç–µ–∫—Å—Ç** ‚Äî —ç—Ç–æ –Ω–∞–±–æ—Ä —Ñ–∞–π–ª–æ–≤, –ø–µ—Ä–µ–¥–∞–≤–∞–µ–º—ã—Ö –¥–µ–º–æ–Ω—É –ø—Ä–∏ `docker build`.

    Docker –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç **–í–°–ï** —Ñ–∞–π–ª—ã, –Ω–µ –∏—Å–∫–ª—é—á—ë–Ω–Ω—ã–µ –≤ `.dockerignore`.

    –ö–æ–Ω—Ç–µ–∫—Å—Ç –º–æ–∂–µ—Ç –±—ã—Ç—å:

    - –ª–æ–∫–∞–ª—å–Ω—ã–º.
    - –∞—Ä—Ö–∏–≤–æ–º.
    - Git-—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–º.
    - STDIN –ø–æ—Ç–æ–∫–æ–º.

| –¢–∏–ø | –ü–æ–¥–¥–µ—Ä–∂–∫–∞ COPY/ADD | –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ |
| :--- | :--- | :--- |
| –ü–∞–ø–∫–∞ | ‚úÖ | –û—Å–Ω–æ–≤–Ω–æ–π —Å–ø–æ—Å–æ–± |
| –ê—Ä—Ö–∏–≤ (`.tar`) | ‚úÖ | –£–¥–æ–±–Ω–æ –¥–ª—è CI/CD |
| Git-—Ä–µ–ø–æ | ‚úÖ | –¢—Ä–µ–±—É–µ—Ç –∏–Ω—Ç–µ—Ä–Ω–µ—Ç, `Dockerfile` –≤ –∫–æ—Ä–Ω–µ |
| STDIN | ‚ùå | –ë–µ–∑ —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã |

!!! warning "–ù–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ—Ä–Ω–µ–≤–æ–π –∫–∞—Ç–∞–ª–æ–≥"

    –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –ø–µ—Ä–µ–¥–∞–≤–∞–π—Ç–µ `/` –∫–∞–∫ –∫–æ–Ω—Ç–µ–∫—Å—Ç.

    –≠—Ç–æ –ø—Ä–∏–≤–µ–¥—ë—Ç –∫ –æ—Ç–ø—Ä–∞–≤–∫–µ –≤—Å–µ–π —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã –≤ Docker, —á—Ç–æ –∫—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏.

---

## üóÉÔ∏è .dockerignore

!!! question "–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ .dockerignore"

    –ê–Ω–∞–ª–æ–≥ `.gitignore` ‚Äî —É–∫–∞–∑—ã–≤–∞–µ—Ç, —á—Ç–æ –∏—Å–∫–ª—é—á–∏—Ç—å –∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ —Å–±–æ—Ä–∫–∏.

!!! example "–ü—Ä–∏–º–µ—Ä `.dockerignore`"

    ```dockerignore
     node_modules
    *.log
    .git
    .env
    ```

!!! info "–ü–æ–ª—å–∑–∞ .dockerignore"

    –≠—Ç–æ –≤–∞–∂–Ω–æ, –ø–æ—Ç–æ–º—É —á—Ç–æ:

    - —É–º–µ–Ω—å—à–∞–µ—Ç —Ä–∞–∑–º–µ—Ä –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞.
    - —É—Å–∫–æ—Ä—è–µ—Ç —Å–±–æ—Ä–∫—É.
    - –ø–æ–≤—ã—à–∞–µ—Ç –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å.

!!! warning "–ü–æ—Ä—è–¥–æ–∫ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π"

    –†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ **COPY** –¥–æ `.dockerignore` –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –ø–æ–ø–∞–¥–∞–Ω–∏—é —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ –≤–Ω—É—Ç—Ä—å –æ–±—Ä–∞–∑–∞.

---

## üß± –°–ª–æ–∏ –∏ –∫–µ—à

!!! info "–ü—Ä–∏–Ω—Ü–∏–ø —Ä–∞–±–æ—Ç—ã —Å–ª–æ–µ–≤"

    –ö–∞–∂–¥–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è —Å–æ–∑–¥–∞—ë—Ç –Ω–µ–º—É—Ç–∞–±–µ–ª—å–Ω—ã–π —Å–ª–æ–π, Docker –∫–µ—à–∏—Ä—É–µ—Ç –∏—Ö –º–µ–∂–¥—É —Å–±–æ—Ä–∫–∞–º–∏.

    ```dockerfile
    FROM alpine            # –°–ª–æ–π 1
    COPY . /app            # –°–ª–æ–π 2
    RUN apk add curl       # –°–ª–æ–π 3
    CMD ["./start.sh"]     # –°–ª–æ–π 4
    ```

!!! info "–ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–ª–æ–µ–≤"

    Docker –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∫—ç—à, –µ—Å–ª–∏:

    - –ø—Ä–µ–¥—ã–¥—É—â–∏–µ —Å–ª–æ–∏ –Ω–µ –∏–∑–º–µ–Ω–∏–ª–∏—Å—å.
    - —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –Ω–µ –æ–±–Ω–æ–≤–∏–ª–æ—Å—å.

    | –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è | –ü–æ–≤–µ–¥–µ–Ω–∏–µ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ |
    | :--- | :--- |
    | `COPY . .` | –ò–∑–º–µ–Ω–µ–Ω–∏–µ –ª—é–±–æ–≥–æ —Ñ–∞–π–ª–∞ —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç –∫—ç—à |
    | `ADD <url>` | –ó–∞–≤–∏—Å–∏—Ç –æ—Ç HTTP-–∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ —Å–µ—Ä–≤–µ—Ä–∞ |
    | `RUN date` | –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –∫–µ—à–∏—Ä—É–µ—Ç—Å—è |

    –ü–æ–ª–µ–∑–Ω—ã–µ –æ–ø—Ü–∏–∏:

    ```bash
    docker build --no-cache .        # –û—Ç–∫–ª—é—á–∞–µ—Ç –∫–µ—à
    docker build --rm=false .        # –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤—Ä–µ–º–µ–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
    ```

---

## üî® Multistage —Å–±–æ—Ä–∫–∞

!!! abstract "üí° –ü—Ä–∏–Ω—Ü–∏–ø Multistage —Å–±–æ—Ä–∫–∏"

    Dockerfile –ø–æ–∑–≤–æ–ª—è–µ—Ç —Å–æ–±–∏—Ä–∞—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤ –æ–¥–Ω–æ–º –æ–±—Ä–∞–∑–µ, –∞ –∑–∞–ø—É—Å–∫–∞—Ç—å –≤ –¥—Ä—É–≥–æ–º - –±–æ–ª–µ–µ –æ–±–ª–µ–≥—á–µ–Ω–Ω–æ–º.

    –ë–ª–∞–≥–æ–¥–∞—Ä—è —á–µ–º—É —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –æ–±—Ä–∞–∑ –Ω–µ –∏–º–µ–µ—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –∏ –∏–º–µ–µ—Ç –º–∞–ª–µ–Ω—å–∫–∏–π —Ä–∞–∑–º–µ—Ä.

!!! example "–ü—Ä–∏–º–µ—Ä Multistage —Å–±–æ—Ä–∫–∏"

    ```dockerfile
    # –°–±–æ—Ä–æ—á–Ω—ã–π —ç—Ç–∞–ø
    FROM golang:1.22 AS builder
    WORKDIR /src
    COPY . .
    RUN go build -o app

    # –§–∏–Ω–∞–ª—å–Ω—ã–π –æ–±—Ä–∞–∑
    FROM alpine
    COPY --from=builder /src/app /app
    ENTRYPOINT ["/app"]
    ```

---

## üßº –û–±—Ä–∞–±–æ—Ç–∫–∞ SIGTERM

!!! note "–ü—Ä–æ–±–ª–µ–º–∞ PID 1"

    –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–æ–ª–∂–µ–Ω –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∑–∞–≤–µ—Ä—à–∞—Ç—å—Å—è –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Å–∏–≥–Ω–∞–ª–æ–≤ (`SIGTERM`, `SIGINT`, `SIGKILL`).

    –û–¥–Ω–∞–∫–æ –º–Ω–æ–≥–∏–µ –±–∞–∑–æ–≤—ã–µ –æ–±—Ä–∞–∑—ã **–Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç —Å–∏–≥–Ω–∞–ª—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ**, –ø–æ—Ç–æ–º—É —á—Ç–æ:

    - –í –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ –ø–µ—Ä–≤–æ–µ –∑–∞–ø—É—â–µ–Ω–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è `PID 1`.
    - –ë–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π **–Ω–µ —Ä–µ–∞–ª–∏–∑—É—é—Ç –ø–æ–≤–µ–¥–µ–Ω–∏–µ init-–ø—Ä–æ—Ü–µ—Å—Å–∞** ‚Äî –Ω–µ –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞—é—Ç —Å–∏–≥–Ω–∞–ª—ã, –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç `SIGCHLD`, –∏ –Ω–µ –æ—á–∏—â–∞—é—Ç –∑–æ–º–±–∏-–ø—Ä–æ—Ü–µ—Å—Å—ã.

!!! question "–ü–æ—á–µ–º—É –≤–∞–∂–Ω–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å `SIGTERM`"

    - `docker stop` –º–æ–∂–µ—Ç –∑–∞–≤–∏—Å–Ω—É—Ç—å –∏ –ø–µ—Ä–µ–π—Ç–∏ –∫ **SIGKILL**, —á—Ç–æ –ø—Ä–∏–≤–µ–¥—ë—Ç –∫ **–∂–µ—Å—Ç–∫–æ–º—É –∑–∞–≤–µ—Ä—à–µ–Ω–∏—é**.
    - –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ —É—Å–ø–µ–µ—Ç **—Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ**, –∑–∞–∫—Ä—ã—Ç—å —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è, –∑–∞–≤–µ—Ä—à–∏—Ç—å —Ñ–æ–Ω–æ–≤—ã–µ –∑–∞–¥–∞—á–∏.
    - –í Kubernetes —ç—Ç–æ –ø—Ä–∏–≤–µ–¥—ë—Ç –∫ –¥–æ–ª–≥–æ–º—É –∑–∞–≤–µ—Ä—à–µ–Ω–∏—é Pod‚Äô–∞ (graceful shutdown –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–µ—Ç).
    - –ó–æ–º–±–∏-–ø—Ä–æ—Ü–µ—Å—Å—ã –º–æ–≥—É—Ç –Ω–∞–∫–∞–ø–ª–∏–≤–∞—Ç—å—Å—è, –æ—Å–æ–±–µ–Ω–Ω–æ –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ `exec`, `subprocess`, `fork`.

!!! tip "–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ tini –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–∏–≥–Ω–∞–ª–æ–≤"

    –î–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–∏–≥–Ω–∞–ª–æ–≤ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ *[`tini`](https://github.com/krallin/tini)* ‚Äî –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π init-–ø—Ä–æ—Ü–µ—Å—Å, –∫–æ—Ç–æ—Ä—ã–π:

    - –ø–µ—Ä–µ–¥–∞—ë—Ç —Å–∏–≥–Ω–∞–ª—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é.
    - –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –¥–æ—á–µ—Ä–Ω–∏—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ (`wait()`).
    - –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –Ω–∞–∫–æ–ø–ª–µ–Ω–∏–µ –∑–æ–º–±–∏.

!!! info "–ü–æ–¥—Ä–æ–±–Ω–µ–µ –æ –ø—Ä–æ—Ü–µ—Å—Å–∞—Ö –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ –∏ `tini` —á–∏—Ç–∞–π—Ç–µ –≤ –≥–ª–∞–≤–µ üëâ [**–ü—Ä–æ—Ü–µ—Å—Å—ã**](./processes.md)."

---

## üîç –û—Ç–ª–∞–¥–∫–∞ Dockerfile

!!! tip "–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –æ—Ç–ª–∞–¥–∫–∞"

    –ü–µ—Ä–µ–¥ —Ç–µ–º –∫–∞–∫ –ø–∏—Å–∞—Ç—å Dockerfile, —É–¥–æ–±–Ω–æ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–æ–º–∞–Ω–¥—ã –≤—Ä—É—á–Ω—É—é:

    ```bash
    docker run -it --rm alpine sh
    ```

    –ò–ª–∏ —Å –¥—Ä—É–≥–∏–º –±–∞–∑–æ–≤—ã–º –æ–±—Ä–∞–∑–æ–º:

    ```bash
    docker run -it --rm python:3.12-slim bash
    ```

    –≠—Ç–æ –ø–æ–º–æ–≥–∞–µ—Ç –≤—ã—è—Å–Ω–∏—Ç—å, –∫–∞–∫–∏–µ –ø–∞–∫–µ—Ç—ã –Ω—É–∂–Ω—ã, –∫–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç shell, –∫–∞–∫–∏–µ –±–∏–Ω–∞—Ä–Ω–∏–∫–∏ –¥–æ—Å—Ç—É–ø–Ω—ã.


!!! example "–û—Ç–ª–∞–¥–∫–∞ ENV, CMD –∏ ENTRYPOINT"

    –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è –∏ –∫–æ–º–∞–Ω–¥:

    ```bash
    docker run --rm myimage env
    docker inspect myimage
    docker run --rm myimage echo Hello
    ```

!!! example "–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è"


    –ß—Ç–æ–±—ã –≤–æ–π—Ç–∏ –≤ –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–π —Å–ª–æ–π –ø—Ä–∏ –æ—à–∏–±–∫–µ –Ω–∞ `RUN`:

    1. –î–æ–±–∞–≤—å—Ç–µ –≤—Ä–µ–º–µ–Ω–Ω—ã–π `RUN tail -f /dev/null` –ø–µ—Ä–µ–¥ –æ—à–∏–±–∞—é—â–∏–º—Å—è —Å–ª–æ–µ–º.
    2. –°–æ–±–µ—Ä–∏—Ç–µ –æ–±—Ä–∞–∑ –∏ –ø–æ–ª—É—á–∏—Ç–µ –µ–≥–æ ID:

        ```bash
        docker build -t debug-image .
        ```

    3. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∏ –∑–∞–π–¥–∏—Ç–µ –≤ –Ω–µ–≥–æ:

        ```bash
        docker run -it debug-image sh
        ```

!!! example "–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ —Å–ª–æ–µ–≤ –∏ –∫–µ—à–∞"

    –ß—Ç–æ–±—ã –ø–æ–Ω—è—Ç—å, –≥–¥–µ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è –ø–µ—Ä–µ—Å–±–æ—Ä–∫–∞ –æ–±—Ä–∞–∑–∞:

    ```bash
    docker build --progress=plain .
    ```

    –ò–ª–∏ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∏—Å—Ç–æ—Ä–∏—é –æ–±—Ä–∞–∑–∞:

    ```bash
    docker history --no-trunc myimage
    ```

    –≠—Ç–æ –ø–æ–∫–∞–∂–µ—Ç, –∫–∞–∫–∏–µ –∫–æ–º–∞–Ω–¥—ã —Å–æ–∑–¥–∞–ª–∏ —Å–ª–æ–∏, –∏ –∫–∞–∫–∏–µ —Å–ª–æ–∏ –∑–∞–∫–µ—à–∏—Ä–æ–≤–∞–ª–∏—Å—å.

---

## üß™ –õ–∏–Ω—Ç–∏–Ω–≥ Dockerfile

!!! tip "–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ hadolint"

    –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ *[`hadolint`](https://github.com/hadolint/hadolint)* ‚Äî –ª–∏–Ω—Ç–µ—Ä –¥–ª—è Dockerfile.

    –û–Ω –ø–æ–º–æ–≥–∞–µ—Ç:

    - –Ω–∞–π—Ç–∏ –∞–Ω—Ç–∏–ø–∞—Ç—Ç–µ—Ä–Ω—ã –∏ –æ—à–∏–±–∫–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `apt-get` –±–µ–∑ `clean`).
    - –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, –Ω–µ –∑–∞–±—ã–ª–∏ –ª–∏ –≤—ã `USER`.
    - —Å–æ–±–ª—é–¥–∞—Ç—å best practices.

    –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–∞–∫ CLI, Docker-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä, GitHub Action –∏–ª–∏ VS Code-—Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ.

---

## üëç –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

!!! success "–û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–∞–∫—Ç–∏–∫–∏"

    –ù–∏–∂–µ –ø–µ—Ä–µ—á–∏—Å–ª–µ–Ω—ã –ø—Ä–∞–≤–∏–ª–∞, –∫–æ—Ç–æ—Ä—ã–µ —Å–ª–µ–¥—É–µ—Ç —Å–æ–±–ª—é–¥–∞—Ç—å –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ Dockerfile.

    1. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –æ—Ç–¥–µ–ª—å–Ω—ã–µ –æ–±—Ä–∞–∑—ã –¥–ª—è —Å–±–æ—Ä–∫–∏ –∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è.
    2. –î–ª—è —Å—Ç–∞–¥–∏–∏ —Å–±–æ—Ä–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ **–æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–µ –æ–±—Ä–∞–∑—ã** —Å `*-slim` –∏–ª–∏ `*-alpine`, –µ—Å–ª–∏ –µ—Å—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å.
    3. –î–ª—è —Å—Ç–∞–¥–∏–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Å—Ç–∞—Ä–∞–π—Ç–µ—Å—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `scratch`, –µ—Å–ª–∏ —ç—Ç–æ –≤–æ–∑–º–æ–∂–Ω–æ.
    4. –í—Å–µ–≥–¥–∞ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–π—Ç–µ `WORKDIR`.
    5. –†–∞–∑–¥–µ–ª—è–π—Ç–µ `COPY` –∏ `RUN`, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –Ω–µ–Ω—É–∂–Ω–æ–≥–æ —Å–±—Ä–æ—Å–∞ –∫—ç—à–∞.
    6. –ú–∏–Ω–∏–º–∏–∑–∏—Ä—É–π—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–ª–æ—ë–≤: –æ–±—ä–µ–¥–∏–Ω—è–π—Ç–µ –∫–æ–º–∞–Ω–¥—ã —á–µ—Ä–µ–∑ `&& \`.
    7. –£–¥–∞–ª—è–π—Ç–µ –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã –ø–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –ø–∞–∫–µ—Ç–æ–≤ (`rm -rf /var/lib/apt/lists/*`).
    8. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `CMD` —Å JSON-—Å–∏–Ω—Ç–∞–∫—Å–∏—Å–æ–º: `CMD ["app"]`, –∞ –Ω–µ `CMD app`. –¢–æ–∂–µ —Å–∞–º–æ–µ –∫–∞—Å–∞–µ—Ç—Å—è `ENTRYPOINT`.

!!! example "Production-ready –ø—Ä–∏–º–µ—Ä Dockerfile"

    ```dockerfile
    # ===============================================================
    # –°—Ç–∞–¥–∏—è 1: –°–±–æ—Ä–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
    # ===============================================================
    FROM golang:1.24.1-bookworm AS builder

    # –ü–µ—Ä–µ–¥–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ `--build-arg`
    ARG COMMIT
    ARG VERSION
    ARG TARGETOS
    ARG TARGETARCH

    # –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–ª—è —Å–±–æ—Ä–∫–∏
    ENV GOOS=${TARGETOS} \
        GOARCH=${TARGETARCH} \
        CGO_ENABLED=1    
     
    # –ö–æ–ø–∏—Ä—É–µ–º —Ñ–∞–π–ª—ã –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –¥–ª—è –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è
    COPY go.mod go.sum ./
    # –°–∫–∞—á–∏–≤–∞–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
    RUN go mod download

    # –ö–æ–ø–∏—Ä—É–µ–º –æ—Å—Ç–∞–ª—å–Ω–æ–π –∏—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥
    COPY . .

    # –°–æ–±–∏—Ä–∞–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
    RUN go build \
        -o /app/nakama \
        -trimpath \
        -ldflags "-s -w -X main.version=${VERSION} -X main.commitID=${COMMIT}"

    # ===============================================================
    # –°—Ç–∞–¥–∏—è 2: –°–æ–∑–¥–∞–Ω–∏–µ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–≥–æ –∏—Å–ø–æ–ª–Ω—è–µ–º–æ–≥–æ –æ–±—Ä–∞–∑–∞
    # ===============================================================
    FROM debian:12-slim

    ARG VERSION

    # –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –æ–±—Ä–∞–∑–∞
    LABEL org.opencontainers.image.authors="Heroic Labs <support@heroiclabs.com>" \
        org.opencontainers.image.version=${VERSION} \
        org.opencontainers.image.title="nakama" \
        org.opencontainers.image.description="Distributed server for social and realtime games and apps."

    # –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–∞–∫–µ—Ç—ã –∏ —Å—Ä–∞–∑—É –∂–µ —á–∏—Å—Ç–∏–º –∫–µ—à –≤ –æ–¥–Ω–æ–º —Å–ª–æ–µ
    RUN apt-get update && \
        apt-get install -y --no-install-recommends \
            ca-certificates \
            tzdata \
            tini && \
        rm -rf /var/lib/apt/lists/*

    # –°–æ–∑–¥–∞–µ–º –Ω–µ–ø—Ä–∏–≤–∏–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
    RUN addgroup --system nakama && adduser --system --ingroup nakama nakama

    # –°–æ–∑–¥–∞–µ–º –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –¥–ª—è –¥–∞–Ω–Ω—ã—Ö –∏ –º–µ–Ω—è–µ–º –≤–ª–∞–¥–µ–ª—å—Ü–∞
    RUN mkdir -p /nakama/data && chown -R nakama:nakama /nakama

    # –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ä–∞–±–æ—á—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é
    WORKDIR /nakama/

    # –ö–æ–ø–∏—Ä—É–µ–º –±–∏–Ω–∞—Ä–Ω–∏–∫ –∏–∑ —Å—Ç–∞–¥–∏–∏ —Å–±–æ—Ä–∫–∏
    COPY --from=builder /app/nakama /
    
    # –ú–µ–Ω—è–µ–º –≤–ª–∞–¥–µ–ª—å—Ü–∞ –±–∏–Ω–∞—Ä–Ω–∏–∫–∞
    RUN chown nakama:nakama /nakama/nakama

    # –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º—Å—è –Ω–∞ –Ω–µ–ø—Ä–∏–≤–∏–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    USER nakama

    # –£–∫–∞–∑—ã–≤–∞–µ–º –ø–æ—Ä—Ç—ã
    EXPOSE 7349 7350 7351

    # –ò—Å–ø–æ–ª—å–∑—É–µ–º tini –∫–∞–∫ init-—Å–∏—Å—Ç–µ–º—É –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–∏–≥–Ω–∞–ª–æ–≤
    ENTRYPOINT ["/usr/bin/tini", "--", "/nakama/nakama"]

    # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
    HEALTHCHECK --interval=10s --timeout=5s --start-period=5s --retries=3 \
      CMD ["/nakama/nakama", "healthcheck"]
    ```
