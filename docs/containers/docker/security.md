---
title: –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å Docker
---

# üõ°Ô∏è –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å Docker

–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –≤ Docker ‚Äî —ç—Ç–æ –º–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤—ã–π –ø—Ä–æ—Ü–µ—Å—Å (Defense-in-Depth), –æ—Ö–≤–∞—Ç—ã–≤–∞—é—â–∏–π —Ö–æ—Å—Ç-—Å–∏—Å—Ç–µ–º—É, Docker Engine, –æ–±—Ä–∞–∑—ã –∏ –∂–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤.

–î–æ—Å—Ç—É–ø –∫ Docker API –∏–ª–∏ —Å–æ–∫–µ—Ç—É –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏ —ç–∫–≤–∏–≤–∞–ª–µ–Ω—Ç–µ–Ω `root`-–¥–æ—Å—Ç—É–ø—É –∫ —Ö–æ—Å—Ç—É, –ø–æ—ç—Ç–æ–º—É –∑–∞—â–∏—Ç–∞ –¥–µ–º–æ–Ω–∞ Docker ‚Äî –ø–µ—Ä–≤–æ–æ—á–µ—Ä–µ–¥–Ω–∞—è –∑–∞–¥–∞—á–∞.

!!! danger "–ü—Ä–∏–≤–∏–ª–µ–≥–∏–∏ Docker ‚Äî —ç—Ç–æ –ø—Ä–∏–≤–∏–ª–µ–≥–∏–∏ root"

    –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å, –∏–º–µ—é—â–∏–π –¥–æ—Å—Ç—É–ø –∫ —Å–æ–∫–µ—Ç—É Docker (`/var/run/docker.sock`), –º–æ–∂–µ—Ç –ª–µ–≥–∫–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å –ø–æ–¥–∫–ª—é—á–µ–Ω–Ω—ã–º –∫–æ—Ä–Ω–µ–≤—ã–º –∫–∞—Ç–∞–ª–æ–≥–æ–º —Ö–æ—Å—Ç–∞ (`-v /:/host`) –∏ –ø–æ–ª—É—á–∏—Ç—å –ø–æ–ª–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–¥ —Å–∏—Å—Ç–µ–º–æ–π.

    **–ù–∏–∫–æ–≥–¥–∞ –Ω–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–π—Ç–µ –¥–æ—Å—Ç—É–ø –∫ Docker –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º, –∫–æ—Ç–æ—Ä—ã–º –Ω–µ –¥–æ–≤–µ—Ä—è–µ—Ç–µ –∫–∞–∫ `root`**.

---

## üèõÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

–í –æ—Å–Ω–æ–≤–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ Docker –ª–µ–∂–∞—Ç –¥–≤–∞ —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç–∞–ª—å–Ω—ã—Ö –º–µ—Ö–∞–Ω–∏–∑–º–∞ —è–¥—Ä–∞ Linux: **–ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞ –∏–º—ë–Ω (Namespaces)** –∏ **–∫–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã–µ –≥—Ä—É–ø–ø—ã (cgroups)**.

–û–Ω–∏ —Å–æ–∑–¥–∞—é—Ç –∏–ª–ª—é–∑–∏—é, —á—Ç–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä ‚Äî —ç—Ç–æ –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞, —Ö–æ—Ç—è –Ω–∞ —Å–∞–º–æ–º –¥–µ–ª–µ —ç—Ç–æ –≤—Å–µ–≥–æ –ª–∏—à—å –æ–±—ã—á–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å –Ω–∞ —Ö–æ—Å—Ç–µ.

!!! info "–ü–æ–¥—Ä–æ–±–Ω–µ–µ –ø—Ä–æ **–ò–∑–æ–ª—è—Ü–∏—è –ø—Ä–æ—Ü–µ—Å—Å–æ–≤** —Å–º. –≤ –≥–ª–∞–≤–µ üëâ [**–ò–∑–æ–ª—è—Ü–∏—è –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ (Namespaces –∏ Cgroups)**](../../linux/core/isolation.md)."

### üõ°Ô∏è –ó–∞—â–∏—Ç–∞ –æ—Ç —ç—Å–∫–∞–ª–∞—Ü–∏–∏

–ó–∞–ø—É—Å–∫ –¥–µ–º–æ–Ω–∞ Docker –∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ –±–µ–∑ –ø—Ä–∞–≤ `root` ‚Äî **—Å–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è –ª—É—á—à–∞—è –ø—Ä–∞–∫—Ç–∏–∫–∞**.

–≠—Ç–æ —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç–∞–ª—å–Ω–æ —Å–Ω–∏–∂–∞–µ—Ç –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç—å –∞—Ç–∞–∫–∏, —Ç–∞–∫ –∫–∞–∫ –¥–∞–∂–µ –≤ —Å–ª—É—á–∞–µ "–ø–æ–±–µ–≥–∞" –∏–∑ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞, –∑–ª–æ—É–º—ã—à–ª–µ–Ω–Ω–∏–∫ –ø–æ–ª—É—á–∏—Ç –ø—Ä–∞–≤–∞ –æ–±—ã—á–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –∞ –Ω–µ `root` –Ω–∞ —Ö–æ—Å—Ç–µ.

!!! question "–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Rootless Docker?"

    **–í—Å–µ–≥–¥–∞, –∫–æ–≥–¥–∞ —ç—Ç–æ –≤–æ–∑–º–æ–∂–Ω–æ.**

    –û—Å–æ–±–µ–Ω–Ω–æ –∫—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è —Å–±–æ—Ä–æ—á–Ω—ã—Ö —Å–µ—Ä–≤–µ—Ä–æ–≤ (CI/CD), –æ–∫—Ä—É–∂–µ–Ω–∏–π –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –∏ –ª—é–±—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤, –≥–¥–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è –Ω–µ–¥–æ–≤–µ—Ä–µ–Ω–Ω—ã–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏.

| –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞ | `dockerd` (—Ä–µ–∂–∏–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) | `dockerd-rootless` (—Ä–µ–∂–∏–º –±–µ–∑ root) |
| :--- | :--- | :--- |
| **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å** | –î–µ–º–æ–Ω —Ä–∞–±–æ—Ç–∞–µ—Ç –æ—Ç `root` | –î–µ–º–æ–Ω —Ä–∞–±–æ—Ç–∞–µ—Ç –æ—Ç –æ–±—ã—á–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è |
| **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** | üí£ **–í—ã—Å–æ–∫–∏–π —Ä–∏—Å–∫**. –£—è–∑–≤–∏–º–æ—Å—Ç—å –≤ –¥–µ–º–æ–Ω–µ = `root`-–¥–æ—Å—Ç—É–ø –∫ —Ö–æ—Å—Ç—É. | ‚úÖ **–ó–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ –±–µ–∑–æ–ø–∞—Å–Ω–µ–µ**. –ö–æ–º–ø—Ä–æ–º–µ—Ç–∞—Ü–∏—è –¥–µ–º–æ–Ω–∞ –¥–∞—ë—Ç –¥–æ—Å—Ç—É–ø —Ç–æ–ª—å–∫–æ –∫ —Ä–µ—Å—É—Ä—Å–∞–º —ç—Ç–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. |
| **–°–µ—Ç–µ–≤–∞—è –∏–∑–æ–ª—è—Ü–∏—è** | –ü–æ–ª–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–¥ `iptables` —Ö–æ—Å—Ç–∞. | –ò—Å–ø–æ–ª—å–∑—É–µ—Ç user-space —Å–µ—Ç–µ–≤–æ–π —Å—Ç–µ–∫ (`slirp4netns`). –ù–µ –º–æ–∂–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å –ø—Ä–∏–≤–∏–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–æ—Ä—Ç—ã (< 1024). |
| **–î—Ä–∞–π–≤–µ—Ä—ã —Ö—Ä–∞–Ω–µ–Ω–∏—è** | `overlay2` (—Ç—Ä–µ–±—É–µ—Ç `root`) | `fuse-overlayfs` (—Ä–∞–±–æ—Ç–∞–µ—Ç –≤ user-space) |
| **–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è** | –ù–µ—Ç | - –ù–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç CNI-–ø–ª–∞–≥–∏–Ω—ã.<br>- –ù–µ –º–æ–∂–µ—Ç –º–æ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –±–ª–æ—á–Ω—ã–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞.<br>- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –ø–æ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —Å–µ—Ç–∏. |
| **–£—Å—Ç–∞–Ω–æ–≤–∫–∞** | –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ Docker | `dockerd-rootless-setuptool.sh install` |

### üè∑Ô∏è –ü—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞ –∏–º—ë–Ω

**Namespaces** —Å–æ–∑–¥–∞—é—Ç –¥–ª—è –ø—Ä–æ—Ü–µ—Å—Å–∞ –∏–ª–ª—é–∑–∏—é, —á—Ç–æ —É –Ω–µ–≥–æ –µ—Å—Ç—å —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π, –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —ç–∫–∑–µ–º–ø–ª—è—Ä –≥–ª–æ–±–∞–ª—å–Ω—ã—Ö —Å–∏—Å—Ç–µ–º–Ω—ã—Ö —Ä–µ—Å—É—Ä—Å–æ–≤.

-   **`PID` (–ø—Ä–æ—Ü–µ—Å—Å—ã)**. –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –≤–∏–¥–∏—Ç —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏ –ø—Ä–æ—Ü–µ—Å—Å—ã.
    –ï–≥–æ –≥–ª–∞–≤–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å –∏–º–µ–µ—Ç PID 1, –∫–∞–∫ `init` –≤ –æ–±—ã—á–Ω–æ–π —Å–∏—Å—Ç–µ–º–µ.
-   **`NET` (—Å–µ—Ç—å)**. –£ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ —Å–≤–æ–π —Å–µ—Ç–µ–≤–æ–π —Å—Ç–µ–∫: IP-–∞–¥—Ä–µ—Å–∞, —Ç–∞–±–ª–∏—Ü—ã –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏, –ø–æ—Ä—Ç—ã.
-   **`MNT` (—Ñ–∞–π–ª–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞)**. –°–≤–æ—ë –¥–µ—Ä–µ–≤–æ —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã.
    –ú–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ/—Ä–∞–∑–º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–µ –≤–ª–∏—è–µ—Ç –Ω–∞ —Ö–æ—Å—Ç.
-   **`UTS` (–∏–º—è —Ö–æ—Å—Ç–∞)**. –ú–æ–∂–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–µ `hostname`.
-   **`IPC` (–≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ)**. –ò–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–µ–º–∞—Ñ–æ—Ä—ã, –æ—á–µ—Ä–µ–¥–∏ —Å–æ–æ–±—â–µ–Ω–∏–π.
-   **`USER` (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏)**. –ü–æ–∑–≤–æ–ª—è–µ—Ç –∏–º–µ—Ç—å `root` (UID 0) –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞, –∫–æ—Ç–æ—Ä—ã–π –Ω–∞ —Å–∞–º–æ–º –¥–µ–ª–µ —è–≤–ª—è–µ—Ç—Å—è –æ–±—ã—á–Ω—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º –Ω–∞ —Ö–æ—Å—Ç–µ.

!!! example "–ü—Ä–∏–º–µ—Ä: –ò–∑–æ–ª—è—Ü–∏—è PID"

    ```bash
    # –ù–∞ —Ö–æ—Å—Ç–µ –º—ã –≤–∏–¥–∏–º –≤—Å–µ –ø—Ä–æ—Ü–µ—Å—Å—ã
    ps aux

    # –í–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ - —Ç–æ–ª—å–∫–æ –µ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å—ã
    docker exec my-container ps aux
    ```

### üéõÔ∏è –ö–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã–µ –≥—Ä—É–ø–ø—ã

**Cgroups** ‚Äî —ç—Ç–æ –º–µ—Ö–∞–Ω–∏–∑–º, –∫–æ—Ç–æ—Ä—ã–π –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ—Ç –∏ —É–ø—Ä–∞–≤–ª—è–µ—Ç —Ñ–∏–∑–∏—á–µ—Å–∫–∏–º–∏ —Ä–µ—Å—É—Ä—Å–∞–º–∏, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–∂–µ—Ç –ø–æ—Ç—Ä–µ–±–ª—è—Ç—å –ø—Ä–æ—Ü–µ—Å—Å (–∏–ª–∏ –≥—Ä—É–ø–ø–∞ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤).

-   **`cpu`**. –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ (`--cpus`).
-   **`memory`**. –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –æ–ø–µ—Ä–∞—Ç–∏–≤–Ω–æ–π –ø–∞–º—è—Ç–∏ (`--memory`).
-   **`io`**. –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –ø—Ä–æ–ø—É—Å–∫–Ω–æ–π —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ –≤–≤–æ–¥–∞-–≤—ã–≤–æ–¥–∞.
-   **`pids`**. –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –¥–æ—á–µ—Ä–Ω–∏—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ (`--pids-limit`).

!!! question "–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Cgroups?"

    **–í—Å–µ–≥–¥–∞.**

    –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –∑–∞–ø—É—Å–∫–∞–π—Ç–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –±–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π –ø–æ —Ä–µ—Å—É—Ä—Å–∞–º –≤ production-—Å—Ä–µ–¥–µ.

    –≠—Ç–æ ‚Äî –æ—Å–Ω–æ–≤–Ω–∞—è –∑–∞—â–∏—Ç–∞ –æ—Ç DoS-–∞—Ç–∞–∫, –∫–æ–≥–¥–∞ –æ–¥–∏–Ω "–ø—Ä–æ–∂–æ—Ä–ª–∏–≤—ã–π" –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –º–æ–∂–µ—Ç –Ω–∞—Ä—É—à–∏—Ç—å —Ä–∞–±–æ—Ç—É –≤—Å–µ–π —Å–∏—Å—Ç–µ–º—ã.

!!! example "–ü—Ä–∏–º–µ—Ä: –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –ø–∞–º—è—Ç–∏"

    ```bash
    # –ó–∞–ø—É—Å–∫–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å –ª–∏–º–∏—Ç–æ–º –≤ 256 –ú–ë –ø–∞–º—è—Ç–∏
    # –ï—Å–ª–∏ –æ–Ω –ø–æ–ø—ã—Ç–∞–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–æ–ª—å—à–µ, OOM-–∫–∏–ª–ª–µ—Ä –µ–≥–æ —É–Ω–∏—á—Ç–æ–∂–∏—Ç.
    docker run -it --memory=256m ubuntu:latest
    ```

---

## üë• –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ UID/GID

–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –ø—Ä–æ—Ü–µ—Å—Å –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è `root` (UID 0).
–≠—Ç–æ —Å–æ–∑–¥–∞—ë—Ç —Å–µ—Ä—å—ë–∑–Ω—ã–π —Ä–∏—Å–∫: –µ—Å–ª–∏ –∑–ª–æ—É–º—ã—à–ª–µ–Ω–Ω–∏–∫ –ø–æ–ª—É—á–∏—Ç –∫–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–¥ –ø—Ä–æ—Ü–µ—Å—Å–æ–º, –æ–Ω –ø–æ–ª—É—á–∏—Ç –ø–æ–ª–Ω—ã–µ –ø—Ä–∞–≤–∞ –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞.

–ß—Ç–æ –µ—â—ë –æ–ø–∞—Å–Ω–µ–µ, –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å `volumes` —ç—Ç–æ—Ç `root` –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ —è–≤–ª—è–µ—Ç—Å—è `root`'–æ–º –Ω–∞ —Ö–æ—Å—Ç-—Å–∏—Å—Ç–µ–º–µ.

**–û—Å–Ω–æ–≤–Ω–∞—è —Ü–µ–ª—å** ‚Äî –∑–∞–ø—É—Å–∫–∞—Ç—å –ø—Ä–æ—Ü–µ—Å—Å—ã –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–º–∏ –ø—Ä–∏–≤–∏–ª–µ–≥–∏—è–º–∏ (non-root).

### üë§ Non-Root USER

–≠—Ç–æ —Å–∞–º—ã–π –ø—Ä–æ—Å—Ç–æ–π –∏ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π —à–∞–≥.

```Dockerfile
FROM alpine:3.18

# –°–æ–∑–¥–∞—ë—Ç –≥—Ä—É–ø–ø—É –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –ö–ª—é—á `-S` (–≤ Alpine) —Å–æ–∑–¥–∞—ë—Ç —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –±–µ–∑ –ø–∞—Ä–æ–ª—è –∏ –¥–æ–º–∞—à–Ω–µ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏.
RUN addgroup -S appgroup && adduser -S appuser -G appgroup

# –£–∫–∞–∑—ã–≤–∞–µ—Ç, —á—Ç–æ –≤—Å–µ –ø–æ—Å–ª–µ–¥—É—é—â–∏–µ –∫–æ–º–∞–Ω–¥—ã (`RUN`, `CMD`, `ENTRYPOINT`) –±—É–¥—É—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è –æ—Ç –∏–º–µ–Ω–∏ —ç—Ç–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
USER appuser

# –≠—Ç–∞ –∫–æ–º–∞–Ω–¥–∞ –±—É–¥–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ –æ—Ç 'appuser'
CMD ["whoami"]
```

### üÜö `gosu` vs `sudo`

–ò–Ω–æ–≥–¥–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é –Ω—É–∂–Ω–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å—Å—è –æ—Ç `root` –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –ø–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∏–∑–º–µ–Ω–∏—Ç—å –≤–ª–∞–¥–µ–ª—å—Ü–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏), –∞ –∑–∞—Ç–µ–º –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç—å—Å—è –Ω–∞ non-root –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è –æ—Å–Ω–æ–≤–Ω–æ–π —Ä–∞–±–æ—Ç—ã.

| –ö—Ä–∏—Ç–µ—Ä–∏–π | `sudo` / `su` | `gosu` |
| :--- | :--- | :--- |
| **–°–æ–∑–¥–∞–Ω–∏–µ –¥–æ—á–µ—Ä–Ω–µ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞** | ‚úÖ –î–∞ ‚Äî —Å–æ–∑–¥–∞—é—Ç –Ω–æ–≤—ã–π –ø—Ä–æ—Ü–µ—Å—Å | ‚ùå –ù–µ—Ç ‚Äî –∑–∞–º–µ–Ω—è–µ—Ç —Ç–µ–∫—É—â–∏–π (`exec`) |
| **PID –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞** | ‚ùå –ù–µ PID 1, –æ—Å—Ç–∞—ë—Ç—Å—è –æ–±–æ–ª–æ—á–∫–∞ | ‚úÖ –¶–µ–ª–µ–≤–æ–π –ø—Ä–æ—Ü–µ—Å—Å —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è PID 1 |
| **–û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–∏–≥–Ω–∞–ª–æ–≤ (SIGTERM)** | ‚ùå –ú–æ–∂–µ—Ç –±—ã—Ç—å –ø—Ä–æ–∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω | ‚úÖ –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ |
| **–ó–æ–º–±–∏-–ø—Ä–æ—Ü–µ—Å—Å—ã** | ‚ùå –í–æ–∑–º–æ–∂–Ω—ã –∏–∑-–∑–∞ –¥–æ—á–µ—Ä–Ω–∏—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ | ‚úÖ –ò—Å–∫–ª—é—á–µ–Ω—ã ‚Äî –æ–¥–∏–Ω –æ—Å–Ω–æ–≤–Ω–æ–π –ø—Ä–æ—Ü–µ—Å—Å |
| **–°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å `--user`** | ‚ö†Ô∏è –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∞, –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ | ‚úÖ –ü–æ–ª–Ω–∞—è, —Ç.–∫. –∏—Å–ø–æ–ª—å–∑—É–µ—Ç API Docker |
| **–õ–µ–≥–∫–æ–≤–µ—Å–Ω–æ—Å—Ç—å** | ‚ùå –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ PAM, TTY –∏ —Ç.–¥. | ‚úÖ –ù–µ—Ç –≤–Ω–µ—à–Ω–∏—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π |
| **–û–ø—Ç–∏–º–∞–ª—å–Ω–æ –¥–ª—è ENTRYPOINT** | ‚ùå –ù–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è | ‚úÖ –î–∞ ‚Äî –±–µ–∑–æ–ø–∞—Å–Ω–∞—è –∑–∞–º–µ–Ω–∞ –ø—Ä–æ—Ü–µ—Å—Å–∞ |

!!! question "–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å gosu?"
    
    –í `ENTRYPOINT` –∏–ª–∏ startup-—Å–∫—Ä–∏–ø—Ç–∞—Ö, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å —á—Ç–æ-—Ç–æ –æ—Ç –∏–º–µ–Ω–∏ root, –∞ –∑–∞—Ç–µ–º –±–µ–∑–æ–ø–∞—Å–Ω–æ –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç—å—Å—è –Ω–∞ –æ–±—ã—á–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –±–µ–∑ –ø–æ—Ç–µ—Ä–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ—Ü–µ—Å—Å–æ–º –∏ —Å–∏–≥–Ω–∞–ª–∞–º–∏.

!!! example "–°—Ä–∞–≤–Ω–µ–Ω–∏–µ –Ω–∞ –ø—Ä–∞–∫—Ç–∏–∫–µ"

    –°—Ä–∞–≤–Ω–∏–º, –∫–∞–∫ `sudo`, `su` –∏ `gosu` –∑–∞–ø—É—Å–∫–∞—é—Ç –ø—Ä–æ—Ü–µ—Å—Å—ã:

    ```bash
    # su —Å–æ–∑–¥–∞—ë—Ç –¥–æ—á–µ—Ä–Ω–∏–π –ø—Ä–æ—Ü–µ—Å—Å (PID 6) –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∫–æ–º–∞–Ω–¥—ã
    $ docker run --rm -it ubuntu:14.04 su -c 'exec ps aux'
    USER       PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND
    root         1  0.0  0.0  46636  2688 ?        Ss+  02:22   0:00 su -c exec ps a
    root         6  0.0  0.0  15576  2220 ?        Rs   02:22   0:00 ps aux

    # sudo —Ä–∞–±–æ—Ç–∞–µ—Ç –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ, —Å–æ–∑–¥–∞–≤–∞—è –¥–æ—á–µ—Ä–Ω–∏–π –ø—Ä–æ—Ü–µ—Å—Å (PID 7)
    $ docker run --rm -it ubuntu:14.04 sudo ps aux
    USER       PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND
    root         1  3.0  0.0  46020  3144 ?        Ss+  02:22   0:00 sudo ps aux
    root         7  0.0  0.0  15576  2172 ?        R+   02:22   0:00 ps aux

    # gosu –∑–∞–º–µ–Ω—è–µ—Ç —Å–æ–±–æ–π –ø—Ä–æ—Ü–µ—Å—Å. ps —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è PID 1.
    $ docker run --rm -it -v /usr/local/bin/gosu:/usr/local/bin/gosu:ro ubuntu:14.04 gosu root ps aux
    USER       PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND
    root         1  0.0  0.0   7140   768 ?        Rs+  02:22   0:00 ps aux
    ```

    –ö–∞–∫ –≤–∏–¥–Ω–æ –∏–∑ –ø—Ä–∏–º–µ—Ä–æ–≤, —Ç–æ–ª—å–∫–æ `gosu` –¥–µ–ª–∞–µ—Ç —Ü–µ–ª–µ–≤–æ–π –ø—Ä–æ—Ü–µ—Å—Å (`ps aux`) –ø—Ä–æ—Ü–µ—Å—Å–æ–º —Å PID 1.
    –≠—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É —Å–∏–≥–Ω–∞–ª–æ–≤ –∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Ä–∞–±–æ—Ç—ã –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞.

    –ö—Ä–æ–º–µ —Ç–æ–≥–æ, `gosu` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –∫–æ–¥ Docker –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ –≥—Ä—É–ø–ø, —á—Ç–æ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç 100% —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å —Ñ–ª–∞–≥–æ–º `--user`.

### üíæ UID/GID –∏ Volumes

–≠—Ç–æ –∫–ª—é—á–µ–≤–∞—è –ø—Ä–æ–±–ª–µ–º–∞ –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å `volumes`.

–§–∞–π–ª—ã –Ω–∞ —Ö–æ—Å—Ç–µ –∏–º–µ—é—Ç –≤–ª–∞–¥–µ–ª—å—Ü–∞ (UID/GID), –∏ –µ—Å–ª–∏ –æ–Ω–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç —Å UID/GID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ, –≤–æ–∑–Ω–∏–∫–Ω—É—Ç –æ—à–∏–±–∫–∏ –¥–æ—Å—Ç—É–ø–∞.

!!! question "–ù—É–∂–Ω–æ –ª–∏ —Å–æ–∑–¥–∞–≤–∞—Ç—å –Ω–∞ —Ö–æ—Å—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞?"

    **–ù–µ—Ç.**

    –Ø–¥—Ä–æ Linux –æ–ø–µ—Ä–∏—Ä—É–µ—Ç —Ç–æ–ª—å–∫–æ —á–∏—Å–ª–æ–≤—ã–º–∏ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–∞–º–∏ (UID/GID).
    –ò–º–µ–Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (`appuser`, `admin`) ‚Äî —ç—Ç–æ –ª–∏—à—å —É–¥–æ–±–Ω–∞—è –¥–ª—è —á–µ–ª–æ–≤–µ–∫–∞ –∞–±—Å—Ç—Ä–∞–∫—Ü–∏—è.
    –ì–ª–∞–≤–Ω–æ–µ, —á—Ç–æ–±—ã **—á–∏—Å–ª–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è UID/GID** —Å–æ–≤–ø–∞–¥–∞–ª–∏.

!!! example "–ü—Ä–æ–≤–µ—Ä–∫–∞ UID/GID"

    **–ù–∞ —Ö–æ—Å—Ç–µ:**

    ```bash
    ls -ln /path/to/your/volume
    # drwxr-xr-x 2 1001 1001 4096 –∞–≤–≥  4 10:00 data
    #                 ^^^^ ^^^^  -> UID=1001, GID=1001
    ```

    **–í –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ:**

    ```bash
    # –ó–∞–ø—É—Å–∫–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∏ —Å–º–æ—Ç—Ä–∏–º UID/GID
    docker run --rm my-image id
    # uid=1000(appuser) gid=1000(appgroup) groups=1000(appgroup)
    ```

    –í –¥–∞–Ω–Ω–æ–º –ø—Ä–∏–º–µ—Ä–µ UID'—ã –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç (1001 –Ω–∞ —Ö–æ—Å—Ç–µ, 1000 –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ), —á—Ç–æ –ø—Ä–∏–≤–µ–¥—ë—Ç –∫ –æ—à–∏–±–∫–µ "Permission denied" –ø—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –∑–∞–ø–∏—Å–∏ –≤ volume.

!!! note "–†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã"

    **–î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π –ø–æ–¥—Ö–æ–¥ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π):** –ü–µ—Ä–µ–¥–∞–≤–∞—Ç—å UID/GID —Ö–æ—Å—Ç–∞ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ.

    1.  **Dockerfile**. –ù–µ —É–∫–∞–∑—ã–≤–∞–π—Ç–µ UID/GID –∂–µ—Å—Ç–∫–æ, —Å–æ–∑–¥–∞–π—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –±–µ–∑ –Ω–∏—Ö.
    2.  **entrypoint.sh**. –°–∫—Ä–∏–ø—Ç, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ —Å–æ–∑–¥–∞—ë—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å –Ω—É–∂–Ω—ã–º–∏ UID/GID.

        ```bash
        # entrypoint.sh
        #!/bin/sh

        # –ü–æ–ª—É—á–∞–µ–º UID/GID –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 1000
        USER_ID=${LOCAL_USER_ID:-1000}
        GROUP_ID=${LOCAL_GROUP_ID:-1000}

        echo "Starting with UID : $USER_ID, GID: $GROUP_ID"
        useradd --shell /bin/bash -u $USER_ID -o -c "" -m user
        groupmod -g $GROUP_ID user

        export HOME=/home/user

        exec gosu user "$@"
        ```

    3.  **–ó–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞**. 

        ```bash
        docker run -d \
          -v /path/to/data:/data \
          # –ü–µ—Ä–µ–¥–∞–µ–º UID/GID —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Ö–æ—Å—Ç–∞
          -e LOCAL_USER_ID=$(id -u) \
          -e LOCAL_GROUP_ID=$(id -g) \
          my-app-image
        ```

    –≠—Ç–æ—Ç –ø–æ–¥—Ö–æ–¥ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ –ø—Ä–∞–≤–∞ –Ω–∞ —Ñ–∞–π–ª—ã –≤—Å–µ–≥–¥–∞ –±—É–¥—É—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–º–∏, –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç —Ç–æ–≥–æ, –Ω–∞ –∫–∞–∫–æ–π –º–∞—à–∏–Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä.

### üóëÔ∏è –£–¥–∞–ª–µ–Ω–∏–µ SUID/SGID

–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –Ω–µ –¥–æ–ª–∂–Ω—ã —Å–æ–¥–µ—Ä–∂–∞—Ç—å –∏—Å–ø–æ–ª–Ω—è–µ–º—ã—Ö —Ñ–∞–π–ª–æ–≤ —Å –±–∏—Ç–∞–º–∏ `setuid` –∏ `setgid`, –ø–æ—Å–∫–æ–ª—å–∫—É –æ–Ω–∏ –ø–æ–∑–≤–æ–ª—è—é—Ç –∏—Å–ø–æ–ª–Ω–µ–Ω–∏–µ –æ—Ç –∏–º–µ–Ω–∏ –≤–ª–∞–¥–µ–ª—å—Ü–∞ (—á–∞—Å—Ç–æ `root`).

–≠—Ç–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ –¥–ª—è —ç—Å–∫–∞–ª–∞—Ü–∏–∏ –ø—Ä–∏–≤–∏–ª–µ–≥–∏–π.

!!! example "–ü–æ–∏—Å–∫ SUID/SGID-—Ñ–∞–π–ª–æ–≤"

    ```dockerfile
    # –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≤—Å–µ —Ñ–∞–π–ª—ã —Å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–º–∏ –±–∏—Ç–∞–º–∏ setuid –∏–ª–∏ setgid
    RUN find / -perm /6000 -type f -exec ls -ld {} \;
    ```

!!! example "–£–¥–∞–ª–µ–Ω–∏–µ –±–∏—Ç–æ–≤"

    ```dockerfile
    # –£–¥–∞–ª—è–µ–º –æ–ø–∞—Å–Ω—ã–µ –±–∏—Ç—ã
    RUN find / -perm /6000 -type f -exec chmod a-s {} \;
    ```

    **–í–∞–∂–Ω–æ**: –Ω–µ —É–¥–∞–ª—è–π—Ç–µ –±–∏—Ç—ã —Å —Å–∏—Å—Ç–µ–º–Ω—ã—Ö —É—Ç–∏–ª–∏—Ç, –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é.
    –õ—É—á—à–µ —Å–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ —Å–ø–∏—Å–æ–∫, –ø—Ä–µ–∂–¥–µ —á–µ–º –ø—Ä–∏–º–µ–Ω—è—Ç—å `chmod`.

---

## üåê –°–µ—Ç–µ–≤–∞—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

Docker –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–µ—Ç—å —Ç–∏–ø–∞ `bridge`, –≥–¥–µ –≤—Å–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –∏–º–µ—é—Ç –¥–æ—Å—Ç—É–ø –¥—Ä—É–≥ –∫ –¥—Ä—É–≥—É.

–≠—Ç–æ —É–¥–æ–±–Ω–æ, –Ω–æ –æ–ø–∞—Å–Ω–æ –≤ –ø—Ä–æ–¥–µ, –æ—Å–æ–±–µ–Ω–Ω–æ –µ—Å–ª–∏ –º–µ–∂–¥—É —Å–µ—Ä–≤–∏—Å–∞–º–∏ –Ω–µ—Ç —á—ë—Ç–∫–æ–π –≥—Ä–∞–Ω–∏—Ü—ã.

!!! warning "–†–∏—Å–∫–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é"

    1. –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –º–æ–≥—É—Ç —Å–≤–æ–±–æ–¥–Ω–æ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞—Ç—å –ø–æ—Ä—Ç—ã –¥—Ä—É–≥ –¥—Ä—É–≥–∞.
    2. –ù–µ—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π –Ω–∞ –º–µ–∂–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–Ω–æ–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ.
    3. –õ—é–±–æ–π —Å –¥–æ—Å—Ç—É–ø–æ–º –∫ Docker –º–æ–∂–µ—Ç "–ø–æ–¥—Å–ª—É—à–∞—Ç—å" —Å–µ—Ç—å —á–µ—Ä–µ–∑ tcpdump.

### üîÅ –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –ø–æ —Å–µ—Ç—è–º

–°–æ–∑–¥–∞–Ω–∏–µ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã—Ö L2-—Å–µ—Ç–µ–π (bridge –∏–ª–∏ overlay) –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–ª–æ—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã: frontend, backend, –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö.

```bash
docker network create frontend-net
docker network create backend-net
```

–ö–∞–∂–¥—ã–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Ç–æ–ª—å–∫–æ –≤ –Ω—É–∂–Ω–æ–π –µ–º—É —Å–µ—Ç–∏.

–ß–µ–º –º–µ–Ω—å—à–µ —Ç–æ—á–µ–∫ —Å–æ–ø—Ä–∏–∫–æ—Å–Ω–æ–≤–µ–Ω–∏—è ‚Äî —Ç–µ–º –≤—ã—à–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å.

!!! example "–ü—Ä–∏–º–µ—Ä docker-compose.yml —Å —Ä–∞–∑–Ω—ã–º–∏ –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–º–∏ —Å–µ—Ç—è–º–∏"

    ```yaml
    version: "3.8"

    services:
      db:
        image: postgres:16-alpine
        networks:
          - backend-net

      app:
        image: my-app-image
        depends_on:
          - db
        networks:
          - frontend-net
          - backend-net

      nginx:
        image: nginx:1.25-alpine
        ports:
          - "80:80"
        networks:
          - frontend-net

    networks:
      frontend-net:
        driver: bridge
      backend-net:
        driver: bridge
    ```

### üìâ –ú–∏–Ω–∏–º–∏–∑–∞—Ü–∏—è –ø–æ—Ä—Ç–æ–≤

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–æ–ª—å–∫–æ –Ω—É–∂–Ω—ã–µ –ø–æ—Ä—Ç—ã —Å `-p` –∏–ª–∏ `--publish`.

–ù–µ –ø—É–±–ª–∏–∫—É–π—Ç–µ –ø–æ—Ä—Ç –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö, –µ—Å–ª–∏ –∫ –Ω–µ–π –Ω–∏–∫—Ç–æ –Ω–µ –¥–æ–ª–∂–µ–Ω –ø–æ–¥–∫–ª—é—á–∞—Ç—å—Å—è –∏–∑–≤–Ω–µ.

```bash
# ‚ùå –ü–ª–æ—Ö–æ: –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –¥–æ—Å—Ç—É–ø–Ω–∞ –∏–∑–≤–Ω–µ
docker run -p 5432:5432 postgres

# ‚úÖ –•–æ—Ä–æ—à–æ: —Ç–æ–ª—å–∫–æ –≤–Ω—É—Ç—Ä–∏ backend-—Å–µ—Ç–∏
docker run --network backend-net postgres
```

### üî• –ë—Ä–∞–Ω–¥–º–∞—É—ç—Ä—ã

–î–∞–∂–µ –ø—Ä–∏ –∏–∑–æ–ª—è—Ü–∏–∏ –≤ Docker-—Å–µ—Ç—è—Ö, –≤–Ω–µ—à–Ω–∏–µ –ø—Ä–∞–≤–∏–ª–∞ —Ö–æ—Å—Ç–∞ –≤–∞–∂–Ω—ã:

- –±–ª–æ–∫–∏—Ä—É–π—Ç–µ –≤—Å—ë –≤—Ö–æ–¥—è—â–µ–µ, –∫—Ä–æ–º–µ —è–≤–Ω–æ —Ä–∞–∑—Ä–µ—à—ë–Ω–Ω–æ–≥–æ.
- —Ñ–∏–ª—å—Ç—Ä—É–π—Ç–µ –∏—Å—Ö–æ–¥—è—â–∏–µ –∑–∞–ø—Ä–æ—Å—ã, –µ—Å–ª–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –Ω–µ –¥–æ–ª–∂–µ–Ω ¬´—Ö–æ–¥–∏—Ç—å¬ª –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç.

!!! note "–ö–∞–∫ Docker –∏—Å–ø–æ–ª—å–∑—É–µ—Ç iptables"

    –ü—Ä–∏ –∑–∞–ø—É—Å–∫–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ Docker –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—ë—Ç –∏ —É–ø—Ä–∞–≤–ª—è–µ—Ç —Å–ª–µ–¥—É—é—â–∏–º–∏ —Ü–µ–ø–æ—á–∫–∞–º–∏ –≤ `iptables`:

    1. `DOCKER`.

        –í —Ü–µ–ø–æ—á–∫–µ `DOCKER` –Ω–∞—Ö–æ–¥—è—Ç—Å—è –ø—Ä–∞–≤–∏–ª–∞ –ø—Ä–æ–±—Ä–æ—Å–∞ –ø–æ—Ä—Ç–æ–≤ (`-p 8080:80`) –∏–∑ –≤–Ω–µ—à–Ω–µ–≥–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã.
        –≠—Ç–∏ –ø—Ä–∞–≤–∏–ª–∞ –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –≤ —Ü–µ–ø–æ—á–∫—É `nat` ‚Üí `PREROUTING` –∏ `filter` ‚Üí `FORWARD`.

        !!! danger "–õ—é–±–æ–µ —Ä—É—á–Ω–æ–µ –≤–º–µ—à–∞—Ç–µ–ª—å—Å—Ç–≤–æ —Å—é–¥–∞ –Ω–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è ‚Äî Docker –ø–µ—Ä–µ–∑–∞–ø–∏—à–µ—Ç –∏—Ö –ø—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å–µ—Ç–∏."

    2. `DOCKER-USER`.

        –≠—Ç–æ —Å–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è —Ü–µ–ø–æ—á–∫–∞, –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø–µ—Ä–≤–æ–π –ø—Ä–∏ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏ –ø–∞–∫–µ—Ç–æ–≤ –æ—Ç/–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞–º.
        –ü—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–∞ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö —Ñ–∏–ª—å—Ç—Ä–æ–≤ ‚Äî Docker –µ—ë –Ω–µ —Ç—Ä–æ–≥–∞–µ—Ç.

        –ò–º–µ–Ω–Ω–æ —Å—é–¥–∞ —Å–ª–µ–¥—É–µ—Ç –¥–æ–±–∞–≤–ª—è—Ç—å –ø—Ä–∞–≤–∏–ª–∞ –¥–ª—è –∫–æ–Ω—Ç—Ä–æ–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ –∫ —Å–µ—Ç–∏.

    3. `FORWARD`.

        –ë–∞–∑–æ–≤–∞—è —Ü–µ–ø–æ—á–∫–∞ Linux, —á–µ—Ä–µ–∑ –∫–æ—Ç–æ—Ä—É—é –ø—Ä–æ—Ö–æ–¥—è—Ç –≤—Å–µ –ø–∞–∫–µ—Ç—ã –º–µ–∂–¥—É –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞–º–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –º–µ–∂–¥—É docker0 –∏ eth0).

        Docker —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –∑–¥–µ—Å—å –ø—Ä–∞–≤–∏–ª–æ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –ø–µ—Ä–µ—Å—ã–ª–∫–∏ –º–µ–∂–¥—É –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞–º–∏.

    | –¶–µ–ø–æ—á–∫–∞ | –ú–æ–∂–Ω–æ –ø–∏—Å–∞—Ç—å –≤—Ä—É—á–Ω—É—é | –ö—Ç–æ –µ—ë —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ—Ç | –ö–æ–≥–¥–∞ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç |
    | :--- | :--- | :--- | :--- |
    | `DOCKER` | ‚ùå **–ù–µ–ª—å–∑—è** | Docker —Å–∞–º | –ü—Ä–∏ –ø—Ä–æ–±—Ä–æ—Å–µ –ø–æ—Ä—Ç–æ–≤ (`-p`) |
    | `DOCKER-USER` | ‚úÖ **–î–∞** | –¢–æ–ª—å–∫–æ –≤—ã | **–ü–µ—Ä–µ–¥** –æ–±—Ä–∞–±–æ—Ç–∫–æ–π Docker'–æ–º |
    | `FORWARD` | ‚òëÔ∏è –° –æ—Å—Ç–æ—Ä–æ–∂–Ω–æ—Å—Ç—å—é | Docker –º–æ–∂–µ—Ç –¥–æ–ø–æ–ª–Ω—è—Ç—å | –û—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏ |

!!! example "–ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –≤—Å–µ–≥–æ –∏—Å—Ö–æ–¥—è—â–µ–≥–æ —Ç—Ä–∞—Ñ–∏–∫–∞, –∫—Ä–æ–º–µ 80/433"

    ```bash
    # –£–¥–∞–ª—è–µ–º –≤—Å–µ —Å—Ç–∞—Ä—ã–µ –ø—Ä–∞–≤–∏–ª–∞ (—Ç–æ–ª—å–∫–æ –∏–∑ DOCKER-USER!)
    iptables -F DOCKER-USER

    # –†–∞–∑—Ä–µ—à–∞–µ–º localhost (–µ—Å–ª–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—É –Ω—É–∂–Ω–æ –æ–±—Ä–∞—â–∞—Ç—å—Å—è –∫ —Ö–æ—Å—Ç—É)
    iptables -A DOCKER-USER -d 127.0.0.1 -j ACCEPT

    # –†–∞–∑—Ä–µ—à–∞–µ–º –≤—ã—Ö–æ–¥ –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç —Ç–æ–ª—å–∫–æ –Ω–∞ –ø–æ—Ä—Ç—ã 80/443
    iptables -A DOCKER-USER -p tcp --dport 80 -j ACCEPT
    iptables -A DOCKER-USER -p tcp --dport 443 -j ACCEPT

    # –ë–ª–æ–∫–∏—Ä—É–µ–º –≤—Å—ë –æ—Å—Ç–∞–ª—å–Ω–æ–µ
    iptables -A DOCKER-USER -j DROP
    ```

---

## ‚õìÔ∏è CI/CD –∏ Supply Chain

–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã —Ä–µ–¥–∫–æ —Å—Ç—Ä–æ—è—Ç—Å—è ¬´—Å –Ω—É–ª—è¬ª ‚Äî –ø–æ—á—Ç–∏ –≤—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è:

- –±–∞–∑–æ–≤—ã–µ –æ–±—Ä–∞–∑—ã (python:3.12-slim, alpine).
- –ø–∞–∫–µ—Ç—ã –∏–∑ –º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤ (pip, apt, npm).
- –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã CI/CD (—Å–∫—Ä–∏–ø—Ç—ã, –∫–ª—é—á–∏, —Ç–æ–∫–µ–Ω—ã).

–õ—é–±–æ–π –∏–∑ —ç—Ç–∏—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –º–æ–∂–µ—Ç –±—ã—Ç—å —É—è–∑–≤–∏–º—ã–º –∏–ª–∏ –∑–ª–æ–Ω–∞–º–µ—Ä–µ–Ω–Ω—ã–º. –ü–æ—ç—Ç–æ–º—É —Å–±–æ—Ä–∫–∞ –∏ —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –æ–±—Ä–∞–∑–æ–≤ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Å—Ç—Ä–æ–≥–æ –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ–º—ã–º–∏.

### üßæ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è SBOM

**SBOM** ‚Äî —ç—Ç–æ –¥–µ–∫–ª–∞—Ä–∞—Ü–∏—è –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π, –∏–∑ –∫–æ—Ç–æ—Ä—ã—Ö —Å–æ—Å—Ç–æ–∏—Ç –æ–±—Ä–∞–∑.

–û–±—è–∑–∞—Ç–µ–ª–µ–Ω –¥–ª—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º —Ç–∞–∫–∏—Ö —Å—Ç–∞–Ω–¥–∞—Ä—Ç–æ–≤, –∫–∞–∫ *SLSA* –∏ *NIST SSDF*.

| –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç | –§–æ—Ä–º–∞—Ç—ã | –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ |
| :--- | :--- | :--- |
| Trivy | CycloneDX, SPDX | –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç SBOM –Ω–∞ –ª–µ—Ç—É –∏–∑ –æ–±—Ä–∞–∑–∞ –∏–ª–∏ –∫–æ–¥–∞ |
| Syft | Table, JSON, SPDX, CycloneDX | –ì–ª—É–±–æ–∫–∏–π –∞–Ω–∞–ª–∏–∑ –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ —Ä–∞–∑–Ω—ã—Ö —è–∑—ã–∫–æ–≤ |

!!! example "–ü—Ä–∏–º–µ—Ä—ã"

    ```bash
    # CycloneDX SBOM –æ—Ç Trivy
    trivy sbom --format cyclonedx -o sbom.json my-app:latest

    # –¢–∞–±–ª–∏—á–Ω—ã–π SBOM –æ—Ç Syft
    syft my-app:latest -o table

    # –î–ª—è CI ‚Äî —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –∫–∞–∫ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç
    syft my-app:latest -o json > sbom.ci.json
    ```

### ‚úçÔ∏è –ü–æ–¥–ø–∏—Å—å –æ–±—Ä–∞–∑–æ–≤

–ü–æ–¥–ø–∏—Å—å –ø–æ–∑–≤–æ–ª—è–µ—Ç —É–¥–æ—Å—Ç–æ–≤–µ—Ä–∏—Ç—å—Å—è, —á—Ç–æ –æ–±—Ä–∞–∑ –±—ã–ª —Å–æ–∑–¥–∞–Ω –¥–æ–≤–µ—Ä–µ–Ω–Ω—ã–º –∏—Å—Ç–æ—á–Ω–∏–∫–æ–º –∏ –Ω–µ –ø–æ–¥–º–µ–Ω—ë–Ω.

| –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç | –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ |
| :--- | :--- |
| *Cosign* | –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç, –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω —Å GitHub Actions, –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∫–ª—é—á–∏ –∏ keyless |
| Docker Content Trust | –ò—Å–ø–æ–ª—å–∑—É–µ—Ç Notary v1 (—É—Å—Ç–∞—Ä–µ–≤–∞—é—â–∏–π, –Ω–æ –≤—Å—ë –µ—â—ë –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è) |
| Notation / Notary v2 | –ù–æ–≤—ã–π —Å—Ç–∞–Ω–¥–∞—Ä—Ç –æ—Ç CNCF, —Å–æ–≤–º–µ—Å—Ç–∏–º —Å OCI –∏ OCI Registry |

!!! example "–ü—Ä–∏–º–µ—Ä —Å Cosign"

    ```bash
    # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–ª—é—á–µ–π
    cosign generate-key-pair

    # –ü–æ–¥–ø–∏—Å—å
    cosign sign --key cosign.key my-app:latest

    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∏
    cosign verify --key cosign.pub my-app:latest
    ```

### üõ†Ô∏è –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–∞–π–ø–ª–∞–π–Ω–∞

```yaml
stages:
  - build
  - scan
  - sign
  - push

build:
  script:
    - docker build -t my-app:latest .
    - syft my-app:latest -o json > sbom.json

scan:
  script:
    - trivy image --exit-code 1 --severity HIGH,CRITICAL my-app:latest

sign:
  script:
    - cosign sign --key cosign.key my-app:latest

push:
  script:
    - docker push my-app:latest
    - cosign upload sbom.json --image my-app:latest
```

---

## ‚öôÔ∏è Immutable Containers

–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å **–Ω–µ–∏–∑–º–µ–Ω—è–µ–º—ã–º–∏ (immutable)**: –æ–Ω–∏ –Ω–µ –∑–∞–ø–∏—Å—ã–≤–∞—é—Ç –Ω–∏—á–µ–≥–æ –Ω–∞ —Å–ª–æ–π –æ–±—Ä–∞–∑–∞ –≤–æ –≤—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã.

–≠—Ç–æ:

- –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤—Ä–µ–¥–æ–Ω–æ—Å–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π.
- —É–ø—Ä–æ—â–∞–µ—Ç –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –æ—Ç–∫–∞—Ç.
- –¥–µ–ª–∞–µ—Ç –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–π.
- –æ–±–ª–µ–≥—á–∞–µ—Ç –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ.

### üì¶ Immutable-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä

–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –Ω–µ –¥–æ–ª–∂–µ–Ω –ø–∏—Å–∞—Ç—å –Ω–∏–∫—É–¥–∞, –∫—Ä–æ–º–µ —è–≤–Ω–æ —É–∫–∞–∑–∞–Ω–Ω—ã—Ö –ø—É—Ç–µ–π (`tmpfs` –∏–ª–∏ `volume`).

–≠—Ç–æ –∑–∞—â–∏—â–∞–µ—Ç –æ—Ç –∞—Ç–∞–∫, —Å–æ—Ö—Ä–∞–Ω—è—é—â–∏—Ö "–∑–∞–∫–ª–∞–¥–∫–∏" –≤ —Ñ–∞–π–ª–æ–≤—É—é —Å–∏—Å—Ç–µ–º—É (backdoors, webshells).

!!! example "–ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Å –ø–æ–º–æ—â—å—é —Ñ–ª–∞–≥–∞ `--read-only`"

    ```bash
    docker run \
        --read-only \
        --tmpfs /tmp --tmpfs /run \
        ...
    ```

### üíæ –ì–¥–µ —Ö—Ä–∞–Ω–∏—Ç—å –¥–∞–Ω–Ω—ã–µ

| –ß—Ç–æ –ø–∏—à–µ—Ç | –ö—É–¥–∞ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å |
| :--- | :--- |
| PID-—Ñ–∞–π–ª—ã, —Å–æ–∫–µ—Ç—ã | `--tmpfs /var/run/...` (RAM, –≤—Ä–µ–º–µ–Ω–Ω–æ) |
| –ö–µ—à | `--tmpfs /var/cache/...` –∏–ª–∏ volume |
| –õ–æ–≥–∏ | –í `stdout/stderr` (–ø—Ä–µ–¥–ø–æ—á—Ç–∏—Ç–µ–ª—å–Ω–æ) –∏–ª–∏ volume (`-v logs:/var/log`) |

### ‚õî –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤

–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –±–µ–∑ –ª–∏–º–∏—Ç–æ–≤ ‚Äî —É–≥—Ä–æ–∑–∞ –≤—Å–µ–π —Å–∏—Å—Ç–µ–º–µ:

- üí• `--memory` –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç ‚Üí –º–æ–∂–Ω–æ —Å—ä–µ—Å—Ç—å –≤—Å—é **RAM** ‚Üí **OOM** —É –¥—Ä—É–≥–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤.
- üî• –Ω–µ—Ç `--pids-limit` ‚Üí –º–æ–∂–Ω–æ –ø–æ—Ä–æ–¥–∏—Ç—å 10K –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ (**fork-–±–æ–º–±–∞**).
- üßÉ –Ω–µ—Ç `--cpus` ‚Üí –º–æ–∂–Ω–æ –∑–∞–Ω—è—Ç—å –≤—Å–µ —è–¥—Ä–∞ –Ω–∞ —Ö–æ—Å—Ç–µ.

### üõ°Ô∏è –ë–µ–∑–æ–ø–∞—Å–Ω—ã–µ —Ñ–ª–∞–≥–∏

| –§–ª–∞–≥ | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
| :--- | :--- |
| `--read-only` | –ù–µ –¥–∞—ë—Ç –ø–∏—Å–∞—Ç—å –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–Ω—É—é FS |
| `--tmpfs /path` | –°–æ–∑–¥–∞—ë—Ç RAM-–¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é (–≤—Ä–µ–º–µ–Ω–Ω–∞—è –∑–∞–ø–∏—Å—å) |
| `--cap-drop=ALL` | –£–¥–∞–ª—è–µ—Ç –≤—Å–µ Linux capabilities (–º–∏–Ω–∏–º—É–º –ø—Ä–∏–≤–∏–ª–µ–≥–∏–π) |
| `--cap-add=NET_BIND_SERVICE` | –¢–æ–ª—å–∫–æ –µ—Å–ª–∏ –Ω—É–∂–µ–Ω –ø–æ—Ä—Ç < 1024 |
| `--security-opt no-new-privileges` | –ó–∞–ø—Ä–µ—â–∞–µ—Ç setuid/setcap –∏ —ç—Å–∫–∞–ª–∞—Ü–∏—é –ø—Ä–∏–≤–∏–ª–µ–≥–∏–π |
| `--pids-limit=100` | –õ–∏–º–∏—Ç –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ |
| `--memory=256m` | –õ–∏–º–∏—Ç –ø–æ –æ–ø–µ—Ä–∞—Ç–∏–≤–Ω–æ–π –ø–∞–º—è—Ç–∏ |
| `--cpus=0.5` | –õ–∏–º–∏—Ç CPU |
| `--user 1001:1001` | Non-root –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å (UID/GID) |

!!! example "Immutable Nginx"

    ```bash
    docker run -d \
      --name secure-nginx \
      --memory=256m \
      --cpus=0.5 \
      --pids-limit=100 \
      --user 101:101 \
      --cap-drop=ALL \
      --cap-add=NET_BIND_SERVICE \
      --security-opt no-new-privileges \
      --read-only \
      --tmpfs /var/run/nginx.pid \
      --tmpfs /var/cache/nginx \
      --tmpfs /var/log/nginx \
      -p 8080:80 \
      nginx:1.25-alpine
    ```

---

## üîí –§—Ä–µ–π–º–≤–æ—Ä–∫–∏ —è–¥—Ä–∞

–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä ‚Äî —ç—Ç–æ –ø—Ä–æ—Ü–µ—Å—Å, –∏ –µ–≥–æ –ø–æ–≤–µ–¥–µ–Ω–∏–µ –º–æ–∂–Ω–æ –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞—Ç—å —Å—Ä–µ–¥—Å—Ç–≤–∞–º–∏ —è–¥—Ä–∞ Linux.

### üìÑ Seccomp

–û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ—Ç —Å–∏—Å—Ç–µ–º–Ω—ã–µ –≤—ã–∑–æ–≤—ã, –∫–æ—Ç–æ—Ä—ã–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å.

Docker –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø—Ä–æ—Ñ–∏–ª—å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (`seccomp-default.json`), –∑–∞–ø—Ä–µ—â–∞—é—â–∏–π **~44 syscalls**.

–ú–æ–∂–Ω–æ —Å–æ–∑–¥–∞–≤–∞—Ç—å —Å–≤–æ–∏ –ø—Ä–æ—Ñ–∏–ª–∏.

!!! example "–ü—Ä–∏–º–µ—Ä —Å–≤–æ–µ–≥–æ –ø—Ä–æ—Ñ–∏–ª—è –¥–ª—è `seccomp`"

    ```json
    {
      "defaultAction": "SCMP_ACT_ERRNO",
      "architectures": [
        "SCMP_ARCH_X86_64",
        "SCMP_ARCH_AARCH64"
      ],
      "syscalls": [
        {
          "names": ["read", "write", "exit", "accept", "epoll_wait"],
          "action": "SCMP_ACT_ALLOW"
        }
      ]
    }
    ```

    –ß—Ç–æ–±—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–π –ø—Ä–æ—Ñ–∏–ª—å –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ñ–ª–∞–≥ `--security-opt`:

    ```bash
    docker run --security-opt seccomp=./seccomp.json my-app
    ```

### üß∞ AppArmor

**AppArmor** –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø—Ä–æ—Ñ–∏–ª–∏, –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞—é—â–∏–µ –¥–æ—Å—Ç—É–ø –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –∫:

- –ø—É—Ç—è–º —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã.
- —Å–∏—Å—Ç–µ–º–Ω—ã–º –æ–ø–µ—Ä–∞—Ü–∏—è–º.

–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `docker-default`.

```bash
docker run --security-opt apparmor=my-profile my-app
```

–°–æ–∑–¥–∞–Ω–∏–µ –∏ –æ—Ç–ª–∞–¥–∫–∞ –ø—Ä–æ—Ñ–∏–ª–µ–π —Ç—Ä–µ–±—É–µ—Ç `apparmor_parser`.

### üß± SELinux

–ë–æ–ª–µ–µ –≥–∏–±–∫–∏–π –º–µ—Ö–∞–Ω–∏–∑–º, —á–µ–º **AppArmor**, –æ—Å–æ–±–µ–Ω–Ω–æ –ø–æ–ª–µ–∑–µ–Ω –≤ RedHat/Fedora-—Å—Ä–µ–¥–∞—Ö.

- **SELinux** –Ω–∞–∫–ª–∞–¥—ã–≤–∞–µ—Ç –º–µ—Ç–∫–∏ (`labels`) –Ω–∞ –ø—Ä–æ—Ü–µ—Å—Å—ã –∏ —Ñ–∞–π–ª—ã.
- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç **multi-category security (MCS)**.
- –ú–æ–∂–µ—Ç –ø—Ä–∏–º–µ–Ω—è—Ç—å—Å—è –∫–∞–∫ –Ω–∞ —É—Ä–æ–≤–Ω–µ `host`, —Ç–∞–∫ –∏ –≤ OpenShift.

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
ls -Z /var/www

# –ó–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ —Å SELinux label
docker run -v /data:/data:Z ...
```

!!! success "Best Practice"

    –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ–º–±–∏–Ω–∞—Ü–∏—é seccomp, AppArmor (–∏–ª–∏ SELinux), –∞ —Ç–∞–∫–∂–µ --read-only, --cap-drop=ALL –∏ --no-new-privileges.

    –≠—Ç–æ —Å–æ–∑–¥–∞—ë—Ç –º–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤—É—é –º–æ–¥–µ–ª—å –∑–∞—â–∏—Ç—ã.

---

## üõ†Ô∏è –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –∞–Ω–∞–ª–∏–∑–∞

| –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç | –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ |
| :--- | :--- |
| *Trivy* | –°–∫–∞–Ω–∏—Ä—É–µ—Ç –æ–±—Ä–∞–∑—ã, –∏—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥, –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏, —Å–µ–∫—Ä–µ—Ç—ã –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≥–µ–Ω–µ—Ä–∞—Ü–∏—é SBOM –∏ OCI-–≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ. –û—Ç–ª–∏—á–Ω—ã–π –≤—ã–±–æ—Ä –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é. |
| *Grype* | –ë—ã—Å—Ç—Ä—ã–π CLI-–∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –æ—Ç Anchore. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –≥–ª—É–±–æ–∫–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ CVE –≤ –æ–±—Ä–∞–∑–∞—Ö –∏ –∫–∞—Ç–∞–ª–æ–≥–∞—Ö. –•–æ—Ä–æ—à–æ –∏–Ω—Ç–µ–≥—Ä–∏—Ä—É–µ—Ç—Å—è —Å `syft`. |
| *Docker Scout* | –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω –≤ Docker CLI. –û—Ç–ª–∏—á–µ–Ω –¥–ª—è –±—ã—Å—Ç—Ä–æ–π –æ—Ü–µ–Ω–∫–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è –æ–±—Ä–∞–∑–∞. –•–æ—Ä–æ—à–æ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ –∏ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤ CI. |
| *Snyk* | –ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ —Å –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–º. –ò–¥–µ–∞–ª—å–Ω–∞ –¥–ª—è –∫–æ–º–∞–Ω–¥, –∫–æ—Ç–æ—Ä—ã–º –≤–∞–∂–Ω–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å CI, GitHub –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å—é –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –Ω–∞ –≤—Å–µ—Ö —É—Ä–æ–≤–Ω—è—Ö. |
| *Dockle* | –õ—ë–≥–∫–∏–π –∞—É–¥–∏—Ç Dockerfile –∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞: `USER`, `HEALTHCHECK`, `CMD`, capabilities. –û—Ç–ª–∏—á–Ω–æ —Å–æ—á–µ—Ç–∞–µ—Ç—Å—è —Å Trivy. |

### üß™ –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å

| –°—Ü–µ–Ω–∞—Ä–∏–π | –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç(—ã) | –ü–æ—á–µ–º—É |
| :--- | :--- | :--- |
| ‚úÖ **–ë—ã—Å—Ç—Ä—ã–π –∞—É–¥–∏—Ç –æ–±—Ä–∞–∑–∞ –Ω–∞ CVE** | Trivy, Grype, Docker Scout | –¢–æ—á–Ω—ã, –±—ã—Å—Ç—Ä—ã –∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç –≤—Å–µ –ø–æ–ø—É–ª—è—Ä–Ω—ã–µ –û–° |
| üîê **–ü—Ä–æ–≤–µ—Ä–∫–∞ Dockerfile –Ω–∞ –ø–ª–æ—Ö–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏** | Dockle | –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç `USER`, `HEALTHCHECK`, `CMD`, `EXPOSE` –∏ –º–Ω–æ–≥–æ–µ –¥—Ä—É–≥–æ–µ |
| üîç **–ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –Ω–∞ —É—è–∑–≤–∏–º–æ—Å—Ç–∏** | Snyk, Trivy | Trivy —Å–∫–∞–Ω–∏—Ä—É–µ—Ç `requirements.txt`, `package-lock.json` –∏ —Ç.d. |
| üîé **–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏ –ø—Ä–æ–≤–µ—Ä–∫–∞ SBOM** | Trivy, Syft + Grype | –ü–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫ –ü–û –≤ –æ–±—Ä–∞–∑–µ –¥–ª—è –∞—É–¥–∏—Ç–∞ –∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è |
| üì¶ **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å CI/CD –∏ Policy Enforcement** | Snyk, Trivy | –ü–æ–∑–≤–æ–ª—è—é—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –ø–∞–π–ø–ª–∞–π–Ω –ø—Ä–∏ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–∏ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —É—è–∑–≤–∏–º–æ—Å—Ç–µ–π |
| üß∞ **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Docker CLI –∏ –ø—Ä–æ—Å—Ç–æ—Ç–∞** | Docker Scout | –ü—Ä—è–º–æ –≤ `docker scout cves` –∏–ª–∏ `docker scout quickview` |

### üìã –ü—Ä–∏–º–µ—Ä—ã

!!! example "üì¶ Trivy ‚Äî —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π —Å–∫–∞–Ω–µ—Ä"

    ```bash
    # –°–∫–∞–Ω–∏—Ä–æ–≤–∞—Ç—å Docker-–æ–±—Ä–∞–∑
    trivy image my-app:latest

    # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥ –Ω–∞ —É—è–∑–≤–∏–º–æ—Å—Ç–∏ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è—Ö
    trivy fs .

    # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è SBOM –≤ —Ñ–æ—Ä–º–∞—Ç–µ CycloneDX
    trivy sbom --format cyclonedx my-app:latest

    # –ü—Ä–µ—Ä–≤–∞—Ç—å CI –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —É—è–∑–≤–∏–º–æ—Å—Ç–µ–π
    trivy image --exit-code 1 --severity CRITICAL my-app:latest
    ```

!!! example "üîé Grype ‚Äî —Ç–æ—á–Ω—ã–π –∞–Ω–∞–ª–∏–∑ CVE"

    ```bash
    # –°–∫–∞–Ω–∏—Ä–æ–≤–∞—Ç—å –æ–±—Ä–∞–∑
    grype my-app:latest

    # –°–∫–∞–Ω–∏—Ä–æ–≤–∞—Ç—å –ª–æ–∫–∞–ª—å–Ω—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –ø—Ä–æ–µ–∫—Ç–∞
    grype dir:/path/to/project

    # –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å SBOM –æ—Ç syft
    syft my-app:latest -o json > sbom.json
    grype sbom:sbom.json
    ```

!!! example "üê≥ Docker Scout ‚Äî –±—ã—Å—Ç—Ä–æ –∏ –≤—Å—Ç—Ä–æ–µ–Ω–æ"

    ```bash
    # –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ CVE –¥–ª—è –æ–±—Ä–∞–∑–∞
    docker scout cves my-app:latest

    # –ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
    docker scout packages my-app:latest

    # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –º–µ–∂–¥—É –¥–≤—É–º—è –≤–µ—Ä—Å–∏—è–º–∏ –æ–±—Ä–∞–∑–∞
    docker scout compare my-app:v1 my-app:v2
    ```

!!! example "üß¨ Snyk ‚Äî –∞—É–¥–∏—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –∏ Dockerfile"

    ```bash
    # –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
    snyk auth

    # –ü—Ä–æ–≤–µ—Ä–∫–∞ Docker-–æ–±—Ä–∞–∑–∞
    snyk container test my-app:latest

    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞ –Ω–∞ Node.js
    snyk test

    # –ü—Ä–æ–≤–µ—Ä–∫–∞ Dockerfile –Ω–∞ –æ—à–∏–±–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
    snyk code test
    ```

!!! example "üîê Dockle ‚Äî —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π –∞—É–¥–∏—Ç Dockerfile"

    ```bash
    # –ê–Ω–∞–ª–∏–∑ Docker-–æ–±—Ä–∞–∑–∞
    dockle my-app:latest

    # –ò–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–µ –ø–æ–ª–∏—Ç–∏–∫–∏
    dockle --ignore CIS-DI-0001,CIS-DI-0005 my-app:latest

    # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —É–∫–∞–∑–∞–Ω –ª–∏ USER, HEALTHCHECK, –æ–≥—Ä–∞–Ω–∏—á–µ–Ω—ã –ª–∏ capabilities
    ```

---

## üí• –û—Å–Ω–æ–≤–Ω—ã–µ —É–≥—Ä–æ–∑—ã

!!! info "CIS Docker Benchmark"

    *CIS Docker Benchmark* ‚Äî —ç—Ç–æ –Ω–∞–±–æ—Ä best-practice —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π –ø–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–µ Docker-—Å—Ä–µ–¥—ã –æ—Ç Center for Internet Security (CIS).

    –û–Ω –æ—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç:

    - –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é —Ö–æ—Å—Ç–∞ –∏ –¥–µ–º–æ–Ω–∞ Docker.
    - –Ω–∞—Å—Ç—Ä–æ–π–∫—É –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤, –æ–±—Ä–∞–∑–æ–≤, volumes –∏ networking.
    - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–æ–º –∏ –∞—É–¥–∏—Ç.

    !!! info "–ü–æ–¥—Ä–æ–±–Ω–µ–µ –ø—Ä–æ **Docker Bench for Security** —Å–º. –≤ –∏—Å—Ç–æ—á–Ω–∏–∫–µ üëâ [**Docker Bench for Security**](https://github.com/docker/docker-bench-security)."

    –î–æ–∫—É–º–µ–Ω—Ç –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–∞–∫ —á–µ–∫–ª–∏—Å—Ç, –∞ —Ç–∞–∫–∂–µ –≤—Å—Ç—Ä–∞–∏–≤–∞—Ç—å –≤ CI/CD –ø–∞–π–ø–ª–∞–π–Ω —Å –ø–æ–º–æ—â—å—é –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞ *Docker Bench for Security*:

    ```bash
    docker run --rm --net host --pid host --userns host --cap-add audit_control \
        -e DOCKER_CONTENT_TRUST=$DOCKER_CONTENT_TRUST \
        -v /etc:/etc:ro \
        -v /usr/bin/containerd:/usr/bin/containerd:ro \
        -v /usr/bin/runc:/usr/bin/runc:ro \
        -v /usr/lib/systemd:/usr/lib/systemd:ro \
        -v /var/lib:/var/lib:ro \
        -v /var/run/docker.sock:/var/run/docker.sock:ro \
        --label docker_bench_security \
        docker-bench-security
    ```

!!! danger "üí• –£—è–∑–≤–∏–º–æ—Å—Ç–∏ –≤ —è–¥—Ä–µ Linux"

    –í—Å–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –Ω–∞ –æ–¥–Ω–æ–º —Ö–æ—Å—Ç–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç **–æ–¥–Ω–æ –∏ —Ç–æ –∂–µ —è–¥—Ä–æ**.

    –£—è–∑–≤–∏–º–æ—Å—Ç—å –≤ —è–¥—Ä–µ –º–æ–∂–µ—Ç –ø–æ–∑–≤–æ–ª–∏—Ç—å –∑–ª–æ—É–º—ã—à–ª–µ–Ω–Ω–∏–∫—É –≤—ã–π—Ç–∏ –∏–∑ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –∏ –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ —Ö–æ—Å—Ç-—Å–∏—Å—Ç–µ–º–µ.

    **–ó–∞—â–∏—Ç–∞:**

    -   –°–≤–æ–µ–≤—Ä–µ–º–µ–Ω–Ω–æ –æ–±–Ω–æ–≤–ª—è–π—Ç–µ —è–¥—Ä–æ —Ö–æ—Å—Ç–∞.
    -   –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ SELinux, AppArmor, Seccomp –∏ `sysctl` –¥–ª—è —É—Å–∏–ª–µ–Ω–∏—è –∏–∑–æ–ª—è—Ü–∏–∏.
    -   –ó–∞–ø—É—Å–∫–∞–π—Ç–µ Docker –≤ —Ä–µ–∂–∏–º–µ `rootless`.

!!! danger "üí£ Denial-of-Service (DoS)"

    –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –±–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π –ø–æ —Ä–µ—Å—É—Ä—Å–∞–º –º–æ–∂–µ—Ç –∏—Å—á–µ—Ä–ø–∞—Ç—å –≤—Å—é –¥–æ—Å—Ç—É–ø–Ω—É—é –ø–∞–º—è—Ç—å, CPU –∏–ª–∏ I/O —Ö–æ—Å—Ç–∞, –≤—ã–∑—ã–≤–∞—è –æ—Ç–∫–∞–∑ –≤ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–∏.

    **–ó–∞—â–∏—Ç–∞:**

    -   –í—Å–µ–≥–¥–∞ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–π—Ç–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –Ω–∞ —Ä–µ—Å—É—Ä—Å—ã (`--memory`, `--cpus`, `--pids-limit`, `ulimit`).

!!! danger "üîì –í–∑–ª–æ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ (Privilege Escalation)"

    –ü—Ä–æ—Ü–µ—Å—Å, –∑–∞–ø—É—â–µ–Ω–Ω—ã–π –æ—Ç `root` –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ, –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —É—è–∑–≤–∏–º–æ—Å—Ç–∏ –¥–ª—è "–ø–æ–±–µ–≥–∞" –∏–∑ –∏–∑–æ–ª—è—Ü–∏–∏.

    **–ó–∞—â–∏—Ç–∞:**

    -   **–ü—Ä–∏–Ω—Ü–∏–ø –º–∏–Ω–∏–º–∞–ª—å–Ω—ã—Ö –ø—Ä–∏–≤–∏–ª–µ–≥–∏–π**. –ó–∞–ø—É—Å–∫–∞–π—Ç–µ –ø—Ä–æ—Ü–µ—Å—Å—ã –æ—Ç non-root –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
    -   –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `--cap-drop=ALL` –∏ –¥–æ–±–∞–≤–ª—è–π—Ç–µ —Ç–æ–ª—å–∫–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ capabilities.
    -   –ü—Ä–æ–µ–∫—Ç–∏—Ä—É–π—Ç–µ **Immutable Containers** —Å —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º–æ–π `--read-only`.

!!! danger "‚ò£Ô∏è –ó–∞—Ä–∞–∂–µ–Ω–Ω—ã–µ –æ–±—Ä–∞–∑—ã"

    –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –æ–±—Ä–∞–∑–æ–≤ –∏–∑ –Ω–µ–¥–æ–≤–µ—Ä–µ–Ω–Ω—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –∑–∞–ø—É—Å–∫—É –≤—Ä–µ–¥–æ–Ω–æ—Å–Ω–æ–≥–æ –∫–æ–¥–∞.

    **–ó–∞—â–∏—Ç–∞:**

    -   –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –æ–±—Ä–∞–∑—ã –∏–∑ –¥–æ–≤–µ—Ä–µ–Ω–Ω—ã—Ö –ø—Ä–∏–≤–∞—Ç–Ω—ã—Ö —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤.
    -   –°–∫–∞–Ω–∏—Ä—É–π—Ç–µ –æ–±—Ä–∞–∑—ã –Ω–∞ —É—è–∑–≤–∏–º–æ—Å—Ç–∏ –≤ CI/CD (`Trivy`, `Grype`, `Docker Scout`).
    -   –ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ –ø–æ–¥–ø–∏—Å–∏ –æ–±—Ä–∞–∑–æ–≤ (Docker Content Trust, Cosign).

!!! danger "ü§´ –ù–∞—Ä—É—à–µ–Ω–∏—è –∑–∞—â–∏—Ç—ã –∑–∞–∫—Ä—ã—Ç—ã—Ö –¥–∞–Ω–Ω—ã—Ö"

    –•—Ä–∞–Ω–µ–Ω–∏–µ —Å–µ–∫—Ä–µ—Ç–æ–≤ –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è –∏–ª–∏ —Å–ª–æ—è—Ö –æ–±—Ä–∞–∑–∞ –Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω–æ.

    **–ó–∞—â–∏—Ç–∞:**

    -   –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ Docker Secrets, Kubernetes Secrets –∏–ª–∏ Vault.
    -   –î–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ —Å–µ–∫—Ä–µ—Ç–æ–≤ –Ω–∞ —ç—Ç–∞–ø–µ —Å–±–æ—Ä–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ BuildKit: `RUN --mount=type=secret,id=mysecret ...`.
